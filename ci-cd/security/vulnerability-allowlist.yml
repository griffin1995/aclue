# =============================================================================
# aclue Platform Vulnerability Allowlist
# =============================================================================
#
# This file contains managed security exceptions for known vulnerabilities
# that have been reviewed and accepted by the security team. Each entry
# must include justification and expiration date.
#
# IMPORTANT: All entries must be regularly reviewed and updated.
#
# =============================================================================

# Format version for compatibility tracking
version: "1.0"

# Last reviewed date - MUST be updated when changes are made
last_reviewed: "2025-01-24"

# Review cycle - how often this file should be reviewed
review_cycle_days: 30

# Vulnerability allowlist entries
allowlist:
  # npm/Node.js Dependencies
  npm:
    - id: "GHSA-example-1234"
      cve: "CVE-2024-12345"
      package: "example-package"
      version: "1.0.0"
      severity: "medium"
      justification: "Example entry - vulnerability affects testing functionality only, not production code"
      expiration_date: "2025-03-01"
      reviewer: "security-team"
      status: "approved"

    # Jinja2 vulnerability in development dependencies
    - id: "70612"
      cve: "CVE-2024-22195"
      package: "jinja2"
      version: "3.1.2"
      severity: "medium"
      justification: "Development dependency only, used in testing environment. Production uses different template engine."
      expiration_date: "2025-04-01"
      reviewer: "dev-team"
      status: "approved"

  # Python/pip Dependencies
  python:
    - id: "safety-example-1234"
      cve: "CVE-2024-example"
      package: "example-python-package"
      version: "2.0.0"
      severity: "low"
      justification: "Example entry - affects deprecated functionality not used in aclue platform"
      expiration_date: "2025-02-28"
      reviewer: "backend-team"
      status: "approved"

  # Docker/Container Vulnerabilities
  docker:
    - id: "docker-example-1234"
      cve: "CVE-2024-container"
      component: "base-image"
      version: "python:3.11-slim"
      severity: "low"
      justification: "Example entry - base image vulnerability mitigated by runtime security controls"
      expiration_date: "2025-03-15"
      reviewer: "devops-team"
      status: "approved"

  # Secret Detection False Positives
  secrets:
    - id: "secret-fp-1"
      tool: "gitleaks"
      file: "docs/api-examples.md"
      pattern: "example-api-key-format"
      justification: "Documentation example showing API key format, not actual secret"
      expiration_date: "2025-06-01"
      reviewer: "security-team"
      status: "approved"

    - id: "secret-fp-2"
      tool: "detect-secrets"
      file: "web/src/types/api.ts"
      pattern: "type definition with key-like structure"
      justification: "TypeScript type definition, not actual secret value"
      expiration_date: "2025-05-01"
      reviewer: "frontend-team"
      status: "approved"

  # Code Analysis False Positives
  code_analysis:
    - id: "eslint-security-1"
      tool: "eslint-plugin-security"
      rule: "detect-object-injection"
      file: "web/src/utils/api-helpers.ts"
      line: 45
      justification: "False positive - object property is validated before use"
      expiration_date: "2025-04-15"
      reviewer: "frontend-team"
      status: "approved"

    - id: "bandit-1"
      tool: "bandit"
      rule: "B101"
      file: "backend/tests/test_security.py"
      line: 123
      justification: "Test file using assert statement for test validation, not production code"
      expiration_date: "2025-05-01"
      reviewer: "backend-team"
      status: "approved"

# Expired entries (kept for audit trail)
expired:
  - id: "expired-example-1"
    original_id: "GHSA-old-1234"
    expiration_date: "2024-12-01"
    status: "expired"
    action_taken: "Vulnerability patched via dependency update"
    resolved_date: "2024-11-15"

# Review history
review_history:
  - date: "2025-01-24"
    reviewer: "security-team"
    action: "Initial creation"
    entries_added: 8
    entries_removed: 0
    entries_expired: 0

  - date: "2024-12-01"
    reviewer: "security-team"
    action: "Monthly review"
    entries_added: 0
    entries_removed: 1
    entries_expired: 1

# Approval workflow
approval_workflow:
  # Who can approve different severity levels
  approval_matrix:
    critical: ["security-team", "cto"]
    high: ["security-team", "tech-lead"]
    medium: ["security-team", "senior-dev"]
    low: ["tech-lead", "senior-dev"]

  # Required approvals by severity
  required_approvals:
    critical: 2
    high: 2
    medium: 1
    low: 1

  # Maximum allowlist duration by severity
  max_duration_days:
    critical: 7    # Critical vulnerabilities can only be allowlisted for 7 days
    high: 30       # High vulnerabilities for 30 days
    medium: 90     # Medium vulnerabilities for 90 days
    low: 180       # Low vulnerabilities for 180 days

# Monitoring and alerts
monitoring:
  # Alert when allowlist entries are about to expire
  expiration_warning_days: 7

  # Alert when too many vulnerabilities are allowlisted
  max_allowlisted_vulnerabilities:
    critical: 0
    high: 3
    medium: 10
    low: 20

  # Metrics to track
  metrics:
    - "total_allowlisted_vulnerabilities"
    - "allowlist_coverage_percentage"
    - "average_time_to_resolution"
    - "expired_entries_count"

# Integration settings
integrations:
  # GitHub integration for tracking allowlist changes
  github:
    create_issues: true
    label_prefix: "security-allowlist"

  # Slack notifications for expiring entries
  slack:
    enabled: false
    webhook_url: ""
    notification_channel: "#security-alerts"

  # JIRA integration for vulnerability tracking
  jira:
    enabled: false
    project_key: "SEC"
    issue_type: "Security Exception"
