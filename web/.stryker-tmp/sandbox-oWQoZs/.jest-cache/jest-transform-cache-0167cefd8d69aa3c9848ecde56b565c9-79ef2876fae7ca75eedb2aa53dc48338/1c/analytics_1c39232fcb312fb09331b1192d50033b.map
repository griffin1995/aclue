{"version":3,"sources":["/home/jack/Documents/aclue-preprod/web/src/lib/analytics.ts"],"sourcesContent":["/**\n * aclue Analytics Service\n * \n * Comprehensive user behavior tracking and analytics integration using PostHog.\n * Provides business intelligence, user insights, and performance metrics for\n * data-driven product decisions and revenue optimization.\n * \n * Key Features:\n *   - User behavior tracking (swipes, clicks, conversions)\n *   - Revenue analytics (affiliate clicks, commissions)\n *   - Feature flag management for A/B testing\n *   - User segmentation and cohort analysis\n *   - Error tracking and performance monitoring\n * \n * Business Intelligence:\n *   - Track user journey from discovery to purchase\n *   - Measure recommendation algorithm effectiveness\n *   - Monitor affiliate conversion rates and revenue\n *   - Analyze user engagement and retention patterns\n * \n * Privacy & Compliance:\n *   - GDPR-compliant user consent management\n *   - User opt-out functionality\n *   - Data anonymization and retention policies\n *   - Cookie consent integration\n * \n * Integration:\n *   - PostHog for event tracking and analytics\n *   - Feature flags for controlled rollouts\n *   - User identification for personalized experiences\n *   - Custom event validation and enrichment\n * \n * Usage:\n *   import { analytics, trackEvent, identifyUser } from '@/lib/analytics';\n *   \n *   // Initialize analytics\n *   await analytics.init();\n *   \n *   // Track user events\n *   trackEvent('product_swiped', { direction: 'right', product_id: '123' });\n *   \n *   // Identify users\n *   identifyUser('user_123', { subscription_tier: 'premium' });\n */\n\nimport posthog from 'posthog-js';\nimport { config } from '@/config';\nimport { createPostHogConfig, validateEvent, getCommonEventProperties } from './posthog-config';\n\n/**\n * Analytics Service class for comprehensive user behavior tracking.\n * \n * Manages PostHog integration with robust error handling, retry logic,\n * and business-specific event tracking. Provides type-safe analytics\n * interface for the entire application.\n * \n * Architecture:\n *   - Singleton pattern for consistent analytics instance\n *   - Automatic initialization with retry logic\n *   - Event validation and enrichment\n *   - Feature flag integration\n *   - Privacy controls and opt-out functionality\n * \n * Error Handling:\n *   - Graceful degradation when analytics unavailable\n *   - Automatic retry on initialization failures\n *   - Comprehensive logging for debugging\n *   - Fallback behavior for critical paths\n */\nclass AnalyticsService {\n  /**\n   * Service state management for reliable analytics operation.\n   */\n  private initialized = false;        // Analytics initialization status\n  private retryCount = 0;             // Current retry attempt counter\n  private maxRetries = 3;             // Maximum initialization retry attempts\n\n  /**\n   * Initialize PostHog analytics service with robust error handling.\n   * \n   * Performs comprehensive setup including:\n   *   - PostHog SDK initialization with custom configuration\n   *   - Connection testing and validation\n   *   - Automatic retry on failures\n   *   - Development vs production environment handling\n   * \n   * Error Recovery:\n   *   - Retries initialization up to maxRetries times\n   *   - Exponential backoff for retry delays\n   *   - Graceful degradation if initialization fails\n   * \n   * Environment Handling:\n   *   - Server-side rendering compatibility (no window)\n   *   - Development debugging and logging\n   *   - Production optimizations\n   * \n   * Returns:\n   *   Promise<void>: Resolves when initialization complete\n   */\n  async init() {\n    // Prevent initialization in invalid environments\n    if (typeof window === 'undefined' || this.initialized || !config.posthogKey) {\n      return;\n    }\n\n    try {\n      // Create PostHog configuration with environment-specific settings\n      const posthogConfig = createPostHogConfig();\n      \n      console.log('[PostHog] Initializing analytics service...', {\n        key: config.posthogKey?.substring(0, 10) + '...',  // Masked key for security\n        host: posthogConfig.api_host,                       // PostHog server host\n        debug: posthogConfig.debug,                         // Debug mode status\n      });\n\n      // Initialize PostHog SDK with configuration\n      posthog.init(config.posthogKey, posthogConfig);\n      \n      // Mark as successfully initialized\n      this.initialized = true;\n      this.retryCount = 0;                                  // Reset retry counter\n\n      // Verify analytics connectivity with test event\n      await this.testConnection();\n      \n    } catch (error) {\n      console.error('[PostHog] Initialization failed:', error);\n      \n      // Implement retry logic with exponential backoff\n      if (this.retryCount < this.maxRetries) {\n        this.retryCount++;\n        const delayMs = 1000 * this.retryCount;              // Exponential backoff\n        console.log(`[PostHog] Retrying initialization (${this.retryCount}/${this.maxRetries}) in ${delayMs}ms...`);\n        setTimeout(() => this.init(), delayMs);\n      } else {\n        console.error('[PostHog] Maximum retry attempts reached, analytics disabled');\n      }\n    }\n  }\n\n  /**\n   * Test PostHog connectivity with diagnostic event.\n   * \n   * Sends a test event to verify that analytics are working correctly.\n   * Provides debugging information for troubleshooting connection issues.\n   * \n   * Test Event Data:\n   *   - Common properties (user agent, URL, timestamp)\n   *   - Initialization metadata (time, retry count)\n   *   - Environment information for debugging\n   * \n   * Returns:\n   *   Promise<void>: Resolves when test complete\n   */\n  private async testConnection(): Promise<void> {\n    if (!this.initialized) return;\n\n    try {\n      // Send diagnostic event with initialization metadata\n      this.track('analytics_service_initialized', {\n        ...getCommonEventProperties(),              // Standard event properties\n        initialization_time: Date.now(),           // Timestamp for performance tracking\n        retry_count: this.retryCount,              // Number of retries for debugging\n        environment: config.isProduction ? 'production' : 'development',\n      });\n      \n      console.log('[PostHog] Connection test successful - analytics ready');\n    } catch (error) {\n      console.warn('[PostHog] Connection test failed:', error);\n    }\n  }\n\n  /**\n   * Identify user for personalized analytics and targeting.\n   * \n   * Associates all future events with a specific user ID, enabling:\n   *   - Cross-device tracking and session continuity\n   *   - Personalized feature flags and A/B tests\n   *   - User-specific analytics and cohort analysis\n   *   - Revenue attribution and lifetime value tracking\n   * \n   * Privacy Compliance:\n   *   - Only identifies users who have provided consent\n   *   - Supports pseudonymous identifiers for privacy\n   *   - Respects user opt-out preferences\n   * \n   * Parameters:\n   *   userId: Unique user identifier (UUID, email hash, etc.)\n   *   properties: Additional user attributes for segmentation\n   * \n   * Example:\n   *   analytics.identify('user_123', {\n   *     email: 'user@example.com',\n   *     subscription_tier: 'premium',\n   *     first_name: 'John',\n   *     signup_date: '2024-01-01'\n   *   });\n   */\n  identify(userId: string, properties?: Record<string, any>) {\n    if (this.initialized) {\n      console.log('[PostHog] Identifying user:', userId, properties);\n      posthog.identify(userId, properties);\n    }\n  }\n\n  /**\n   * Track user events for analytics and business intelligence.\n   * \n   * Records user actions, behaviors, and system events for:\n   *   - Product analytics and user journey mapping\n   *   - Revenue tracking and conversion optimization\n   *   - A/B testing and feature performance measurement\n   *   - Error monitoring and performance analysis\n   * \n   * Event Processing:\n   *   - Validates event name and properties\n   *   - Enriches events with common properties (timestamp, user agent, etc.)\n   *   - Handles errors gracefully without breaking user experience\n   *   - Logs events for debugging in development\n   * \n   * Common Event Categories:\n   *   - User actions: swipe_left, swipe_right, product_clicked\n   *   - Revenue events: affiliate_click, purchase_completed\n   *   - System events: page_viewed, error_occurred\n   *   - Engagement: session_started, feature_used\n   * \n   * Parameters:\n   *   eventName: Descriptive event name (snake_case convention)\n   *   properties: Event-specific data for analysis\n   * \n   * Example:\n   *   analytics.track('product_swiped', {\n   *     direction: 'right',\n   *     product_id: 'B08GYKNCCP',\n   *     category: 'Electronics',\n   *     session_id: 'session_123'\n   *   });\n   */\n  track(eventName: string, properties?: Record<string, any>) {\n    // Handle analytics not initialized gracefully\n    if (!this.initialized) {\n      console.warn('[PostHog] Analytics not initialized, event queued:', eventName);\n      // In production, could queue events for later sending\n      return;\n    }\n\n    // Validate event meets naming and data requirements\n    if (!validateEvent(eventName, properties)) {\n      return;\n    }\n\n    try {\n      // Enrich event with common properties for consistent analytics\n      const enrichedProperties = {\n        ...getCommonEventProperties(),      // Standard properties (timestamp, URL, etc.)\n        ...properties,                      // Event-specific properties\n      };\n\n      console.log('[PostHog] Tracking event:', eventName, enrichedProperties);\n      posthog.capture(eventName, enrichedProperties);\n    } catch (error) {\n      console.error('[PostHog] Failed to track event:', eventName, error);\n      // Continue execution even if analytics fails\n    }\n  }\n\n  /**\n   * Set or update user properties for segmentation and personalization.\n   * \n   * Updates user profile data for:\n   *   - User segmentation and cohort analysis\n   *   - Personalized feature flags and targeting\n   *   - Revenue analysis and lifetime value tracking\n   *   - Customer support and user insights\n   * \n   * Property Categories:\n   *   - Demographics: age, location, gender\n   *   - Subscription: tier, status, billing_cycle\n   *   - Behavior: last_login, total_swipes, preferences\n   *   - Revenue: total_spent, commission_generated\n   * \n   * Parameters:\n   *   properties: Key-value pairs of user attributes\n   * \n   * Example:\n   *   analytics.setUserProperties({\n   *     subscription_tier: 'premium',\n   *     total_swipes: 150,\n   *     last_active: '2024-01-01',\n   *     favorite_categories: ['Electronics', 'Books']\n   *   });\n   */\n  setUserProperties(properties: Record<string, any>) {\n    if (this.initialized) {\n      console.log('[PostHog] Setting user properties:', properties);\n      posthog.people.set(properties);\n    }\n  }\n\n  /**\n   * Track page views for navigation analytics and user journey mapping.\n   * \n   * Records page navigation events for:\n   *   - User flow analysis and conversion funnels\n   *   - Page performance and engagement metrics\n   *   - A/B testing of page layouts and content\n   *   - SEO and content optimization insights\n   * \n   * Automatic Enrichment:\n   *   - Referrer information for traffic source analysis\n   *   - Page load time and performance metrics\n   *   - Device and browser information\n   *   - User session context\n   * \n   * Parameters:\n   *   path: Optional page path (defaults to current URL)\n   * \n   * Example:\n   *   analytics.trackPageView('/discover'); // Track specific page\n   *   analytics.trackPageView();            // Track current page\n   */\n  trackPageView(path?: string) {\n    if (this.initialized) {\n      const pageUrl = path || window.location.href;\n      console.log('[PostHog] Tracking page view:', pageUrl);\n      \n      posthog.capture('$pageview', {\n        $current_url: pageUrl,              // Page URL for navigation tracking\n        page_title: document.title,         // Page title for content analysis\n        referrer: document.referrer,        // Previous page for traffic flow\n      });\n    }\n  }\n\n  /**\n   * Reset user session for logout and privacy compliance.\n   * \n   * Clears all user identification and session data for:\n   *   - User logout and session termination\n   *   - Privacy compliance and data protection\n   *   - Shared device usage scenarios\n   *   - Testing and development environments\n   * \n   * Reset Actions:\n   *   - Clears user identification and properties\n   *   - Resets feature flag cache\n   *   - Generates new anonymous session ID\n   *   - Maintains analytics functionality for anonymous tracking\n   * \n   * Privacy Compliance:\n   *   - Ensures no personal data persists after logout\n   *   - Supports \"right to be forgotten\" requirements\n   *   - Clears all locally stored user data\n   * \n   * Example:\n   *   // On user logout\n   *   analytics.reset();\n   */\n  reset() {\n    if (this.initialized) {\n      console.log('[PostHog] Resetting user session');\n      posthog.reset();\n    }\n  }\n\n  /**\n   * Associate user with groups for organizational analytics.\n   * \n   * Groups users by organization, team, or other entities for:\n   *   - B2B analytics and enterprise insights\n   *   - Team collaboration feature usage\n   *   - Organization-level reporting and billing\n   *   - Multi-tenant application analytics\n   * \n   * Group Types:\n   *   - organization: Company or business entity\n   *   - team: Department or project team\n   *   - subscription: Shared subscription account\n   *   - family: Family gift-giving groups\n   * \n   * Parameters:\n   *   groupType: Type of group (organization, team, etc.)\n   *   groupKey: Unique identifier for the group\n   *   properties: Group-specific attributes\n   * \n   * Example:\n   *   analytics.group('organization', 'acme-corp', {\n   *     name: 'Acme Corporation',\n   *     plan: 'enterprise',\n   *     employees: 500\n   *   });\n   */\n  group(groupType: string, groupKey: string, properties?: Record<string, any>) {\n    if (this.initialized) {\n      console.log('[PostHog] Setting group:', groupType, groupKey, properties);\n      posthog.group(groupType, groupKey, properties);\n    }\n  }\n\n  /**\n   * Check if a feature flag is enabled for the current user.\n   * \n   * Enables controlled feature rollouts and A/B testing for:\n   *   - Gradual feature releases to user segments\n   *   - A/B testing of new functionality\n   *   - Kill switches for problematic features\n   *   - Personalized user experiences\n   * \n   * Feature Flag Categories:\n   *   - UI features: new_swipe_interface, dark_mode\n   *   - Business logic: premium_recommendations, affiliate_tracking\n   *   - Experiments: recommendation_algorithm_v2\n   *   - Rollouts: mobile_app_promotion\n   * \n   * Parameters:\n   *   flag: Feature flag name (snake_case convention)\n   * \n   * Returns:\n   *   boolean: True if feature is enabled for current user\n   * \n   * Example:\n   *   if (analytics.isFeatureEnabled('new_recommendation_engine')) {\n   *     // Show new recommendation UI\n   *   }\n   */\n  isFeatureEnabled(flag: string): boolean {\n    if (this.initialized) {\n      const enabled = posthog.isFeatureEnabled(flag) === true;\n      console.log(`[PostHog] Feature flag '${flag}':`, enabled);\n      return enabled;\n    }\n    return false;  // Default to disabled if analytics not available\n  }\n\n  /**\n   * Get feature flag value for advanced flag configurations.\n   * \n   * Retrieves feature flag values that can be:\n   *   - Boolean: true/false for simple on/off features\n   *   - String: variant names for multivariate tests\n   *   - Number: configuration values or percentages\n   * \n   * Advanced Use Cases:\n   *   - Multivariate testing with multiple variants\n   *   - Configuration flags with specific values\n   *   - Percentage-based rollouts\n   *   - String-based feature variants\n   * \n   * Parameters:\n   *   flag: Feature flag name\n   * \n   * Returns:\n   *   string | boolean | undefined: Flag value or undefined if not set\n   * \n   * Example:\n   *   const variant = analytics.getFeatureFlag('recommendation_algorithm');\n   *   if (variant === 'collaborative_filtering') {\n   *     // Use collaborative filtering algorithm\n   *   } else if (variant === 'content_based') {\n   *     // Use content-based algorithm\n   *   }\n   */\n  getFeatureFlag(flag: string): string | boolean | undefined {\n    if (this.initialized) {\n      const value = posthog.getFeatureFlag(flag);\n      console.log(`[PostHog] Feature flag '${flag}' value:`, value);\n      return value;\n    }\n    return undefined;\n  }\n\n  /**\n   * Opt user out of analytics tracking for privacy compliance.\n   * \n   * Provides user control over data collection for:\n   *   - GDPR and privacy regulation compliance\n   *   - User preference and consent management\n   *   - Cookie banner and privacy controls\n   *   - Data minimization principles\n   * \n   * Opt-Out Effects:\n   *   - Stops all event tracking and data collection\n   *   - Disables feature flags and personalization\n   *   - Maintains basic functionality without analytics\n   *   - Sets persistent opt-out preference\n   * \n   * Privacy Compliance:\n   *   - Respects user privacy choices\n   *   - Provides clear opt-out mechanism\n   *   - Maintains opt-out status across sessions\n   * \n   * Example:\n   *   // User clicks \"Opt out of analytics\"\n   *   analytics.optOut();\n   */\n  optOut() {\n    if (this.initialized) {\n      console.log('[PostHog] User opted out of analytics tracking');\n      posthog.opt_out_capturing();\n    }\n  }\n\n  /**\n   * Opt user into analytics tracking after previous opt-out.\n   * \n   * Re-enables analytics for users who previously opted out:\n   *   - Restores full analytics functionality\n   *   - Re-enables feature flags and personalization\n   *   - Resumes event tracking and data collection\n   *   - Updates user consent preferences\n   * \n   * Use Cases:\n   *   - User changes privacy preferences\n   *   - Premium users enabling advanced features\n   *   - Onboarding flow consent updates\n   *   - Settings page privacy controls\n   * \n   * Example:\n   *   // User clicks \"Enable analytics\"\n   *   analytics.optIn();\n   */\n  optIn() {\n    if (this.initialized) {\n      console.log('[PostHog] User opted into analytics tracking');\n      posthog.opt_in_capturing();\n    }\n  }\n\n  /**\n   * Check if user has opted out of analytics tracking.\n   * \n   * Determines user's current privacy preference for:\n   *   - Conditional UI rendering based on consent\n   *   - Privacy settings page status display\n   *   - Feature availability and functionality\n   *   - Compliance with privacy regulations\n   * \n   * Returns:\n   *   boolean: True if user has opted out, false otherwise\n   * \n   * Example:\n   *   if (!analytics.hasOptedOut()) {\n   *     // Show analytics-dependent features\n   *     renderPersonalizedRecommendations();\n   *   }\n   */\n  hasOptedOut(): boolean {\n    if (this.initialized) {\n      return posthog.has_opted_out_capturing();\n    }\n    return false;  // Default to opted-in if analytics not available\n  }\n}\n\n// ==============================================================================\n// SINGLETON ANALYTICS INSTANCE\n// ==============================================================================\n// Global analytics instance for application-wide usage\n\n/**\n * Global analytics service instance.\n * \n * Singleton pattern ensures consistent analytics across the entire application.\n * Use this instance for all analytics operations to maintain state and configuration.\n */\nexport const analytics = new AnalyticsService();\n\n// ==============================================================================\n// CONVENIENCE FUNCTIONS\n// ==============================================================================\n// Simplified API for common analytics operations\n\n/**\n * Track user event with simplified API.\n * \n * Convenience function for the most common analytics operation.\n * Provides type-safe event tracking without direct service access.\n * \n * Parameters:\n *   eventName: Descriptive event name (snake_case)\n *   properties: Optional event data\n * \n * Example:\n *   trackEvent('button_clicked', { button_id: 'signup' });\n */\nexport const trackEvent = (eventName: string, properties?: Record<string, any>) => {\n  analytics.track(eventName, properties);\n};\n\n/**\n * Identify user with simplified API.\n * \n * Convenience function for user identification without direct service access.\n * \n * Parameters:\n *   userId: Unique user identifier\n *   properties: Optional user attributes\n * \n * Example:\n *   identifyUser('user_123', { email: 'user@example.com' });\n */\nexport const identifyUser = (userId: string, properties?: Record<string, any>) => {\n  analytics.identify(userId, properties);\n};\n\n/**\n * Track page view with simplified API.\n * \n * Convenience function for page view tracking without direct service access.\n * \n * Parameters:\n *   path: Optional page path (defaults to current URL)\n * \n * Example:\n *   trackPageView('/discover');\n */\nexport const trackPageView = (path?: string) => {\n  analytics.trackPageView(path);\n};\n\n// Default export for importing as single module\nexport default analytics;\n\n// Export all public interfaces\n// Exported: analytics, trackEvent, identifyUser, trackPageView, AnalyticsService"],"names":["analytics","identifyUser","trackEvent","trackPageView","AnalyticsService","init","window","initialized","config","posthogKey","posthogConfig","createPostHogConfig","console","log","key","substring","host","api_host","debug","posthog","retryCount","testConnection","error","maxRetries","delayMs","setTimeout","track","getCommonEventProperties","initialization_time","Date","now","retry_count","environment","isProduction","warn","identify","userId","properties","eventName","validateEvent","enrichedProperties","capture","setUserProperties","people","set","path","pageUrl","location","href","$current_url","page_title","document","title","referrer","reset","group","groupType","groupKey","isFeatureEnabled","flag","enabled","getFeatureFlag","value","undefined","optOut","opt_out_capturing","optIn","opt_in_capturing","hasOptedOut","has_opted_out_capturing"],"mappings":"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"}