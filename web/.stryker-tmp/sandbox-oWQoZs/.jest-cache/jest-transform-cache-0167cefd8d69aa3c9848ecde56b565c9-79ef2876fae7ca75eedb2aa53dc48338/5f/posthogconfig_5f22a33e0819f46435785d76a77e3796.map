{"version":3,"sources":["/home/jack/Documents/aclue-preprod/web/src/lib/posthog-config.ts"],"sourcesContent":["import { PostHogConfig } from 'posthog-js';\nimport { config } from '@/config';\n\n// PostHog configuration factory\nexport function createPostHogConfig(): PostHogConfig {\n  const isDev = config.isDevelopment;\n  const isProd = config.isProduction;\n\n  const baseConfig: PostHogConfig = {\n    // API Configuration\n    api_host: isDev ? 'http://localhost:3000' : config.posthogHost || 'https://eu.i.posthog.com',\n    ui_host: config.posthogHost || 'https://eu.i.posthog.com',\n    \n    // Core Features\n    person_profiles: 'identified_only',\n    capture_pageview: false, // Manual pageview tracking for better proxy compatibility\n    capture_pageleave: true,\n    debug: isDev,\n    \n    // Autocapture Configuration\n    autocapture: {\n      dom_event_allowlist: ['click', 'change', 'submit', 'input'],\n      css_selector_allowlist: [\n        '[data-attr]', \n        '[data-testid]', \n        '[data-ph-capture-attribute]',\n        '.btn',\n        '.button',\n        'button',\n        'a[href]',\n        'input[type=\"submit\"]',\n        'input[type=\"button\"]',\n      ],\n      element_allowlist: [\n        'a', 'button', 'form', 'input', 'select', 'textarea', 'label'\n      ],\n      url_allowlist: isDev ? ['localhost:3000'] : undefined,\n    },\n\n    // Session Recording\n    session_recording: {\n      recordCrossOriginIframes: false,\n      maskAllInputs: true,\n      maskInputOptions: {\n        password: true,\n        email: false,\n        tel: true,\n        credit_card: true,\n      },\n      maskTextSelector: '.sensitive, [data-sensitive]',\n      blockSelector: '.block-recording, [data-block-recording]',\n      ignoreClass: 'ph-ignore',\n      collectFonts: false,\n      inlineStylesheet: false,\n    },\n    disable_session_recording: !isProd,\n\n    // Privacy and Security\n    cross_subdomain_cookie: false,\n    secure_cookie: isProd,\n    respect_dnt: true,\n    opt_out_capturing_by_default: false,\n    \n    // Performance\n    batch_size: isDev ? 10 : 50,\n    request_timeout_ms: 30000,\n    \n    // Persistence\n    persistence: 'localStorage+cookie',\n    persistence_name: `ph_${config.posthogKey}_posthog`,\n    cookie_name: `ph_${config.posthogKey}_posthog`,\n    cookie_expiration: 365, // days\n    disable_persistence: false,\n    \n    // Advanced Features\n    disable_surveys: false,\n    enable_recording_console_log: isDev,\n    capture_performance: isProd,\n    \n    // Error Handling\n    on_xhr_error: (failedRequest) => {\n      console.warn('[PostHog] XHR request failed:', failedRequest);\n    },\n    \n    loaded: (posthog) => {\n      console.log('[PostHog] Analytics service loaded successfully', {\n        mode: isDev ? 'development' : 'production',\n        api_host: posthog.config.api_host,\n        distinct_id: posthog.get_distinct_id(),\n        version: posthog.LIB_VERSION,\n      });\n      \n      // Global access for debugging\n      if (isDev) {\n        window.posthog = posthog;\n        console.log('[PostHog] Available globally as window.posthog for debugging');\n      }\n      \n      // Set up error tracking\n      if (isProd) {\n        window.addEventListener('error', (event) => {\n          posthog.capture('javascript_error', {\n            error_message: event.message,\n            error_filename: event.filename,\n            error_lineno: event.lineno,\n            error_colno: event.colno,\n            error_stack: event.error?.stack,\n          });\n        });\n        \n        window.addEventListener('unhandledrejection', (event) => {\n          posthog.capture('unhandled_promise_rejection', {\n            reason: event.reason?.toString(),\n            stack: event.reason?.stack,\n          });\n        });\n      }\n    },\n  };\n\n  // Development-specific overrides\n  if (isDev) {\n    return {\n      ...baseConfig,\n      // Use local proxy endpoints to avoid CORS\n      api_endpoint: '/api/posthog-proxy',\n      decide_endpoint: '/api/posthog-decide',\n      \n      // Development optimizations\n      advanced_disable_decide: false, // Enable feature flags in dev\n      disable_external_dependency_loading: false,\n      bootstrap: {\n        distinctID: undefined,\n        isIdentifiedID: false,\n        featureFlags: {},\n      },\n      \n      // Faster development feedback\n      property_blacklist: [],\n      sanitize_properties: null,\n      xhr_headers: {\n        'X-PostHog-Source': 'aclue-dev',\n      },\n    };\n  }\n\n  // Production-specific configuration\n  return {\n    ...baseConfig,\n    \n    // Production optimizations\n    advanced_disable_decide: false,\n    disable_external_dependency_loading: false,\n    \n    // Enhanced security\n    mask_all_text: false,\n    mask_all_element_attributes: false,\n    \n    // Performance monitoring\n    capture_performance: true,\n    _capture_metrics: true,\n    \n    // Production headers\n    xhr_headers: {\n      'X-PostHog-Source': 'aclue-prod',\n    },\n  };\n}\n\n// PostHog event validation\nexport function validateEvent(eventName: string, properties?: Record<string, any>): boolean {\n  if (!eventName || typeof eventName !== 'string') {\n    console.warn('[PostHog] Invalid event name:', eventName);\n    return false;\n  }\n  \n  if (eventName.length > 200) {\n    console.warn('[PostHog] Event name too long:', eventName);\n    return false;\n  }\n  \n  if (properties && typeof properties !== 'object') {\n    console.warn('[PostHog] Invalid event properties:', properties);\n    return false;\n  }\n  \n  return true;\n}\n\n// Common event properties\nexport function getCommonEventProperties(): Record<string, any> {\n  return {\n    app_version: config.version,\n    environment: config.isDevelopment ? 'development' : 'production',\n    timestamp: new Date().toISOString(),\n    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    language: navigator.language,\n    user_agent: navigator.userAgent,\n    viewport_width: window.innerWidth,\n    viewport_height: window.innerHeight,\n    screen_width: window.screen.width,\n    screen_height: window.screen.height,\n    referrer: document.referrer,\n    url: window.location.href,\n  };\n}"],"names":["createPostHogConfig","getCommonEventProperties","validateEvent","isDev","config","isDevelopment","isProd","isProduction","baseConfig","api_host","posthogHost","ui_host","person_profiles","capture_pageview","capture_pageleave","debug","autocapture","dom_event_allowlist","css_selector_allowlist","element_allowlist","url_allowlist","undefined","session_recording","recordCrossOriginIframes","maskAllInputs","maskInputOptions","password","email","tel","credit_card","maskTextSelector","blockSelector","ignoreClass","collectFonts","inlineStylesheet","disable_session_recording","cross_subdomain_cookie","secure_cookie","respect_dnt","opt_out_capturing_by_default","batch_size","request_timeout_ms","persistence","persistence_name","posthogKey","cookie_name","cookie_expiration","disable_persistence","disable_surveys","enable_recording_console_log","capture_performance","on_xhr_error","failedRequest","console","warn","loaded","posthog","log","mode","distinct_id","get_distinct_id","version","LIB_VERSION","window","addEventListener","event","capture","error_message","message","error_filename","filename","error_lineno","lineno","error_colno","colno","error_stack","error","stack","reason","toString","api_endpoint","decide_endpoint","advanced_disable_decide","disable_external_dependency_loading","bootstrap","distinctID","isIdentifiedID","featureFlags","property_blacklist","sanitize_properties","xhr_headers","mask_all_text","mask_all_element_attributes","_capture_metrics","eventName","properties","length","app_version","environment","timestamp","Date","toISOString","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","language","navigator","user_agent","userAgent","viewport_width","innerWidth","viewport_height","innerHeight","screen_width","screen","width","screen_height","height","referrer","document","url","location","href"],"mappings":"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"}