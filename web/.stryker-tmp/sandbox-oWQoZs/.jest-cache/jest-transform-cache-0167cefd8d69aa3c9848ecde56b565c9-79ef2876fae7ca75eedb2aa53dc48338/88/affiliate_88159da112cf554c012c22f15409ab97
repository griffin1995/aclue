9e6f4eee6f00f1ca78b5d16f2e1e0095
/**
 * Amazon Affiliate Links Service
 * 
 * Production-ready implementation for Amazon Associates UK affiliate link generation,
 * tracking, analytics, and revenue optimization. Implements industry-standard
 * practices for affiliate marketing compliance and performance tracking.
 */ "use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    AmazonAffiliateService: function() {
        return AmazonAffiliateService;
    },
    affiliateService: function() {
        return affiliateService;
    },
    extractASIN: function() {
        return extractASIN;
    },
    generateAffiliateLink: function() {
        return generateAffiliateLink;
    },
    generateSearchLink: function() {
        return generateSearchLink;
    },
    getAffiliateAnalytics: function() {
        return getAffiliateAnalytics;
    },
    getCommissionRate: function() {
        return getCommissionRate;
    },
    isValidAmazonUrl: function() {
        return isValidAmazonUrl;
    },
    trackAffiliateClick: function() {
        return trackAffiliateClick;
    },
    trackAffiliateConversion: function() {
        return trackAffiliateConversion;
    }
});
const _config = require("../config");
const _analytics = require("./analytics");
class AmazonAffiliateService {
    constructor(){
        this.clickEvents = [];
        this.conversionEvents = [];
        this.initializeTracking();
    }
    static getInstance() {
        if (!AmazonAffiliateService.instance) {
            AmazonAffiliateService.instance = new AmazonAffiliateService();
        }
        return AmazonAffiliateService.instance;
    }
    /**
   * Initialize affiliate tracking and analytics
   */ initializeTracking() {
        if (typeof window !== "undefined") {
            // Load existing events from localStorage
            const storedClicks = localStorage.getItem("aclue_affiliate_clicks");
            const storedConversions = localStorage.getItem("aclue_affiliate_conversions");
            if (storedClicks) {
                try {
                    this.clickEvents = JSON.parse(storedClicks);
                } catch (error) {
                    console.error("Error loading affiliate click events:", error);
                }
            }
            if (storedConversions) {
                try {
                    this.conversionEvents = JSON.parse(storedConversions);
                } catch (error) {
                    console.error("Error loading affiliate conversion events:", error);
                }
            }
            // Clean up old events (older than 30 days)
            this.cleanupOldEvents();
            // Set up periodic cleanup
            setInterval(()=>this.cleanupOldEvents(), 24 * 60 * 60 * 1000); // Daily cleanup
        }
    }
    /**
   * Generate affiliate link with comprehensive tracking
   */ generateAffiliateLink(productUrl, options = {}) {
        try {
            const url = new URL(productUrl);
            // Ensure we're using the correct Amazon domain
            if (!this.isValidAmazonUrl(productUrl)) {
                console.warn("Invalid Amazon URL provided:", productUrl);
                return productUrl;
            }
            // Convert to UK domain if needed
            if (!url.hostname.includes("amazon.co.uk")) {
                url.hostname = "amazon.co.uk";
            }
            // Add associate tag
            url.searchParams.set("tag", options.associateTag || _config.amazonConfig.uk.associateTag);
            // Add tracking parameters
            if (options.ref) {
                url.searchParams.set("ref_", options.ref);
            }
            // UTM parameters for analytics
            if (options.campaign) {
                url.searchParams.set("utm_campaign", options.campaign);
            }
            if (options.medium) {
                url.searchParams.set("utm_medium", options.medium);
            }
            if (options.source) {
                url.searchParams.set("utm_source", options.source);
            }
            if (options.term) {
                url.searchParams.set("utm_term", options.term);
            }
            if (options.content) {
                url.searchParams.set("utm_content", options.content);
            }
            // Add custom parameters
            if (options.customParameters) {
                Object.entries(options.customParameters).forEach(([key, value])=>{
                    url.searchParams.set(key, value);
                });
            }
            // Add unique tracking identifier
            const trackingId = this.generateTrackingId();
            url.searchParams.set("gs_track", trackingId);
            // Add timestamp
            url.searchParams.set("timestamp", Date.now().toString());
            return url.toString();
        } catch (error) {
            console.error("Error generating affiliate link:", error);
            return productUrl;
        }
    }
    /**
   * Generate Amazon search link with affiliate tracking
   */ generateSearchLink(searchTerm, category, options = {}) {
        const baseUrl = "https://amazon.co.uk/s";
        const url = new URL(baseUrl);
        // Search parameters
        url.searchParams.set("k", searchTerm);
        url.searchParams.set("tag", options.associateTag || _config.amazonConfig.uk.associateTag);
        // Category filter
        if (category && _config.amazonConfig.productCategories[category]) {
            url.searchParams.set("i", _config.amazonConfig.productCategories[category]);
        }
        // Tracking parameters
        if (options.ref) {
            url.searchParams.set("ref", options.ref);
        }
        // UTM parameters
        if (options.campaign) url.searchParams.set("utm_campaign", options.campaign);
        if (options.medium) url.searchParams.set("utm_medium", options.medium);
        if (options.source) url.searchParams.set("utm_source", options.source);
        // Add tracking identifier
        const trackingId = this.generateTrackingId();
        url.searchParams.set("gs_track", trackingId);
        return url.toString();
    }
    /**
   * Track affiliate link click with comprehensive analytics
   */ async trackAffiliateClick(event) {
        const clickEvent = {
            ...event,
            timestamp: Date.now(),
            userAgent: typeof window !== "undefined" ? navigator.userAgent : undefined,
            referrer: typeof window !== "undefined" ? document.referrer : undefined
        };
        // Store event locally
        this.clickEvents.push(clickEvent);
        this.persistClickEvents();
        // Send to analytics service
        try {
            await _analytics.analytics.track("affiliate_link_clicked", {
                affiliate_product_id: event.productId,
                affiliate_asin: event.asin,
                affiliate_category: event.category,
                affiliate_price: event.price,
                affiliate_currency: event.currency,
                affiliate_source: event.source,
                affiliate_url: event.affiliateUrl,
                original_url: event.originalUrl,
                user_id: event.userId,
                session_id: event.sessionId
            });
        } catch (error) {
            console.error("Error sending affiliate click to analytics:", error);
        }
        // Send to backend for server-side tracking
        if (_config.config.features.affiliateTracking) {
            try {
                await fetch(`${_config.config.apiUrl}/api/v1/analytics/affiliate/click`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(clickEvent)
                });
            } catch (error) {
                console.error("Error sending affiliate click to backend:", error);
            }
        }
    }
    /**
   * Track affiliate conversion (when user makes a purchase)
   */ async trackAffiliateConversion(event) {
        const conversionEvent = {
            ...event,
            conversionTimestamp: Date.now()
        };
        // Store event locally
        this.conversionEvents.push(conversionEvent);
        this.persistConversionEvents();
        // Send to analytics service
        try {
            await _analytics.analytics.track("affiliate_conversion", {
                affiliate_order_id: event.orderId,
                affiliate_product_id: event.productId,
                affiliate_asin: event.asin,
                affiliate_revenue: event.revenue,
                affiliate_commission: event.commission,
                affiliate_currency: event.currency,
                affiliate_quantity: event.quantity,
                affiliate_category: event.category,
                affiliate_url: event.affiliateUrl,
                conversion_time_minutes: (conversionEvent.conversionTimestamp - event.clickTimestamp) / (1000 * 60),
                user_id: event.userId,
                session_id: event.sessionId
            });
        } catch (error) {
            console.error("Error sending affiliate conversion to analytics:", error);
        }
        // Send to backend
        if (_config.config.features.affiliateTracking) {
            try {
                await fetch(`${_config.config.apiUrl}/api/v1/analytics/affiliate/conversion`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(conversionEvent)
                });
            } catch (error) {
                console.error("Error sending affiliate conversion to backend:", error);
            }
        }
    }
    /**
   * Get comprehensive affiliate analytics
   */ getAnalytics(timeframe = "month") {
        const now = Date.now();
        const timeframMs = {
            day: 24 * 60 * 60 * 1000,
            week: 7 * 24 * 60 * 60 * 1000,
            month: 30 * 24 * 60 * 60 * 1000,
            year: 365 * 24 * 60 * 60 * 1000,
            all: Infinity
        };
        const cutoff = now - timeframMs[timeframe];
        // Filter events by timeframe
        const relevantClicks = this.clickEvents.filter((event)=>event.timestamp >= cutoff);
        const relevantConversions = this.conversionEvents.filter((event)=>event.conversionTimestamp >= cutoff);
        // Calculate metrics
        const totalClicks = relevantClicks.length;
        const totalConversions = relevantConversions.length;
        const totalRevenue = relevantConversions.reduce((sum, event)=>sum + event.revenue, 0);
        const totalCommission = relevantConversions.reduce((sum, event)=>sum + event.commission, 0);
        const conversionRate = totalClicks > 0 ? totalConversions / totalClicks : 0;
        const averageOrderValue = totalConversions > 0 ? totalRevenue / totalConversions : 0;
        // Clicks by category
        const clicksByCategory = {};
        relevantClicks.forEach((event)=>{
            if (event.category) {
                clicksByCategory[event.category] = (clicksByCategory[event.category] || 0) + 1;
            }
        });
        // Revenue by category
        const revenueByCategory = {};
        relevantConversions.forEach((event)=>{
            if (event.category) {
                revenueByCategory[event.category] = (revenueByCategory[event.category] || 0) + event.revenue;
            }
        });
        // Performance by source
        const performanceBySource = {};
        const clicksBySource = {};
        const conversionsBySource = {};
        const revenueBySource = {};
        relevantClicks.forEach((event)=>{
            clicksBySource[event.source] = (clicksBySource[event.source] || 0) + 1;
        });
        relevantConversions.forEach((event)=>{
            // Find corresponding click event
            const clickEvent = relevantClicks.find((click)=>click.productId === event.productId && click.timestamp <= event.clickTimestamp);
            if (clickEvent) {
                conversionsBySource[clickEvent.source] = (conversionsBySource[clickEvent.source] || 0) + 1;
                revenueBySource[clickEvent.source] = (revenueBySource[clickEvent.source] || 0) + event.revenue;
            }
        });
        Object.keys(clicksBySource).forEach((source)=>{
            const clicks = clicksBySource[source] || 0;
            const conversions = conversionsBySource[source] || 0;
            const revenue = revenueBySource[source] || 0;
            performanceBySource[source] = {
                clicks,
                conversions,
                revenue,
                conversionRate: clicks > 0 ? conversions / clicks : 0
            };
        });
        return {
            totalClicks,
            totalConversions,
            totalRevenue,
            totalCommission,
            conversionRate,
            averageOrderValue,
            clicksByCategory,
            revenueByCategory,
            topPerformingProducts: [],
            performanceBySource
        };
    }
    /**
   * Extract ASIN from Amazon product URL
   */ extractASIN(productUrl) {
        try {
            const asinPatterns = [
                /\/dp\/([A-Z0-9]{10})/,
                /\/gp\/product\/([A-Z0-9]{10})/,
                /\/product\/([A-Z0-9]{10})/,
                /\/ASIN\/([A-Z0-9]{10})/,
                /asin=([A-Z0-9]{10})/i,
                /\/([A-Z0-9]{10})(?:\/|\?|$)/
            ];
            for (const pattern of asinPatterns){
                const match = productUrl.match(pattern);
                if (match && match[1]) {
                    return match[1];
                }
            }
            return null;
        } catch (error) {
            console.error("Error extracting ASIN:", error);
            return null;
        }
    }
    /**
   * Validate Amazon URL
   */ isValidAmazonUrl(url) {
        try {
            const urlObj = new URL(url);
            const validDomains = [
                "amazon.co.uk",
                "amazon.com",
                "amazon.de",
                "amazon.fr",
                "amazon.it",
                "amazon.es",
                "amazon.ca",
                "amazon.com.au",
                "amazon.co.jp",
                "amazon.com.br",
                "amazon.in",
                "amazon.com.mx",
                "amazon.cn",
                "amazon.sg",
                "amazon.ae",
                "amazon.nl",
                "amazon.se",
                "amazon.pl"
            ];
            return validDomains.some((domain)=>urlObj.hostname.includes(domain));
        } catch (error) {
            return false;
        }
    }
    /**
   * Get commission rate for product category
   */ getCommissionRate(category) {
        const normalizedCategory = category.toLowerCase().replace(/\s+/g, "");
        const categoryMappings = {
            "electronics": "electronics",
            "computers": "electronics",
            "mobile": "electronics",
            "fashion": "fashion",
            "clothing": "fashion",
            "shoes": "fashion",
            "accessories": "fashion",
            "homeandgarden": "homeAndGarden",
            "home": "homeAndGarden",
            "garden": "homeAndGarden",
            "furniture": "homeAndGarden",
            "kitchen": "homeAndGarden",
            "sportsandoutdoors": "sportsAndOutdoors",
            "sports": "sportsAndOutdoors",
            "fitness": "sportsAndOutdoors",
            "outdoor": "sportsAndOutdoors",
            "books": "books",
            "ebooks": "books",
            "kindle": "books",
            "toys": "toys",
            "toysgames": "toys",
            "games": "toys",
            "videogames": "toys",
            "beauty": "beautyAndPersonalCare",
            "beautyandpersonalcare": "beautyAndPersonalCare",
            "personalcare": "beautyAndPersonalCare",
            "health": "beautyAndPersonalCare",
            "automotive": "automotive",
            "car": "automotive",
            "motorcycle": "automotive",
            "industrial": "industrial",
            "tools": "industrial",
            "business": "industrial"
        };
        const mappedCategory = categoryMappings[normalizedCategory];
        return _config.amazonConfig.commissionRates[mappedCategory] || _config.amazonConfig.commissionRates.default;
    }
    /**
   * Generate unique tracking identifier
   */ generateTrackingId() {
        const timestamp = Date.now().toString(36);
        const random = Math.random().toString(36).substr(2, 9);
        return `gs_${timestamp}_${random}`;
    }
    /**
   * Persist click events to localStorage
   */ persistClickEvents() {
        if (typeof window !== "undefined") {
            try {
                localStorage.setItem("aclue_affiliate_clicks", JSON.stringify(this.clickEvents));
            } catch (error) {
                console.error("Error persisting affiliate click events:", error);
            }
        }
    }
    /**
   * Persist conversion events to localStorage
   */ persistConversionEvents() {
        if (typeof window !== "undefined") {
            try {
                localStorage.setItem("aclue_affiliate_conversions", JSON.stringify(this.conversionEvents));
            } catch (error) {
                console.error("Error persisting affiliate conversion events:", error);
            }
        }
    }
    /**
   * Clean up old events (older than 30 days)
   */ cleanupOldEvents() {
        const thirtyDaysAgo = Date.now() - 30 * 24 * 60 * 60 * 1000;
        this.clickEvents = this.clickEvents.filter((event)=>event.timestamp >= thirtyDaysAgo);
        this.conversionEvents = this.conversionEvents.filter((event)=>event.conversionTimestamp >= thirtyDaysAgo);
        this.persistClickEvents();
        this.persistConversionEvents();
    }
}
const affiliateService = AmazonAffiliateService.getInstance();
const generateAffiliateLink = (url, options)=>affiliateService.generateAffiliateLink(url, options);
const generateSearchLink = (searchTerm, category, options)=>affiliateService.generateSearchLink(searchTerm, category, options);
const trackAffiliateClick = (event)=>affiliateService.trackAffiliateClick(event);
const trackAffiliateConversion = (event)=>affiliateService.trackAffiliateConversion(event);
const extractASIN = (url)=>affiliateService.extractASIN(url);
const isValidAmazonUrl = (url)=>affiliateService.isValidAmazonUrl(url);
const getCommissionRate = (category)=>affiliateService.getCommissionRate(category);
const getAffiliateAnalytics = (timeframe)=>affiliateService.getAnalytics(timeframe);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2phY2svRG9jdW1lbnRzL2FjbHVlLXByZXByb2Qvd2ViL3NyYy9saWIvYWZmaWxpYXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQW1hem9uIEFmZmlsaWF0ZSBMaW5rcyBTZXJ2aWNlXG4gKiBcbiAqIFByb2R1Y3Rpb24tcmVhZHkgaW1wbGVtZW50YXRpb24gZm9yIEFtYXpvbiBBc3NvY2lhdGVzIFVLIGFmZmlsaWF0ZSBsaW5rIGdlbmVyYXRpb24sXG4gKiB0cmFja2luZywgYW5hbHl0aWNzLCBhbmQgcmV2ZW51ZSBvcHRpbWl6YXRpb24uIEltcGxlbWVudHMgaW5kdXN0cnktc3RhbmRhcmRcbiAqIHByYWN0aWNlcyBmb3IgYWZmaWxpYXRlIG1hcmtldGluZyBjb21wbGlhbmNlIGFuZCBwZXJmb3JtYW5jZSB0cmFja2luZy5cbiAqL1xuXG5pbXBvcnQgeyBhbWF6b25Db25maWcsIGNvbmZpZyB9IGZyb20gJ0AvY29uZmlnJztcbmltcG9ydCB7IGFuYWx5dGljcyB9IGZyb20gJ0AvbGliL2FuYWx5dGljcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWZmaWxpYXRlQ2xpY2tFdmVudCB7XG4gIHByb2R1Y3RJZD86IHN0cmluZztcbiAgYXNpbj86IHN0cmluZztcbiAgY2F0ZWdvcnk/OiBzdHJpbmc7XG4gIHByaWNlPzogbnVtYmVyO1xuICBjdXJyZW5jeT86IHN0cmluZztcbiAgYWZmaWxpYXRlVXJsOiBzdHJpbmc7XG4gIG9yaWdpbmFsVXJsPzogc3RyaW5nO1xuICBzb3VyY2U6ICdyZWNvbW1lbmRhdGlvbicgfCAnc2VhcmNoJyB8ICdjYXRlZ29yeScgfCAnZGlyZWN0JztcbiAgdXNlcklkPzogc3RyaW5nO1xuICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICByZWZlcnJlcj86IHN0cmluZztcbiAgdXNlckFnZW50Pzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFmZmlsaWF0ZUNvbnZlcnNpb25FdmVudCB7XG4gIG9yZGVySWQ6IHN0cmluZztcbiAgcHJvZHVjdElkPzogc3RyaW5nO1xuICBhc2luPzogc3RyaW5nO1xuICByZXZlbnVlOiBudW1iZXI7XG4gIGNvbW1pc3Npb246IG51bWJlcjtcbiAgY3VycmVuY3k6IHN0cmluZztcbiAgcXVhbnRpdHk6IG51bWJlcjtcbiAgY2F0ZWdvcnk/OiBzdHJpbmc7XG4gIGFmZmlsaWF0ZVVybDogc3RyaW5nO1xuICBjbGlja1RpbWVzdGFtcDogbnVtYmVyO1xuICBjb252ZXJzaW9uVGltZXN0YW1wOiBudW1iZXI7XG4gIHVzZXJJZD86IHN0cmluZztcbiAgc2Vzc2lvbklkPzogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFmZmlsaWF0ZVByb2R1Y3Qge1xuICBpZDogc3RyaW5nO1xuICBhc2luPzogc3RyaW5nO1xuICB0aXRsZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgcHJpY2U/OiBudW1iZXI7XG4gIGN1cnJlbmN5Pzogc3RyaW5nO1xuICBjYXRlZ29yeT86IHN0cmluZztcbiAgaW1hZ2VVcmw/OiBzdHJpbmc7XG4gIG9yaWdpbmFsVXJsOiBzdHJpbmc7XG4gIGFmZmlsaWF0ZVVybD86IHN0cmluZztcbiAgY29tbWlzc2lvblJhdGU/OiBudW1iZXI7XG4gIGVzdGltYXRlZENvbW1pc3Npb24/OiBudW1iZXI7XG4gIGJyYW5kPzogc3RyaW5nO1xuICBhdmFpbGFiaWxpdHk/OiBzdHJpbmc7XG4gIHJhdGluZz86IG51bWJlcjtcbiAgcmV2aWV3Q291bnQ/OiBudW1iZXI7XG4gIGZlYXR1cmVzPzogc3RyaW5nW107XG4gIGxhc3RVcGRhdGVkOiBEYXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFmZmlsaWF0ZUxpbmtPcHRpb25zIHtcbiAgYXNzb2NpYXRlVGFnPzogc3RyaW5nO1xuICByZWY/OiBzdHJpbmc7XG4gIGNhbXBhaWduPzogc3RyaW5nO1xuICBtZWRpdW0/OiBzdHJpbmc7XG4gIHNvdXJjZT86IHN0cmluZztcbiAgdGVybT86IHN0cmluZztcbiAgY29udGVudD86IHN0cmluZztcbiAgY3VzdG9tUGFyYW1ldGVycz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWZmaWxpYXRlQW5hbHl0aWNzIHtcbiAgdG90YWxDbGlja3M6IG51bWJlcjtcbiAgdG90YWxDb252ZXJzaW9uczogbnVtYmVyO1xuICB0b3RhbFJldmVudWU6IG51bWJlcjtcbiAgdG90YWxDb21taXNzaW9uOiBudW1iZXI7XG4gIGNvbnZlcnNpb25SYXRlOiBudW1iZXI7XG4gIGF2ZXJhZ2VPcmRlclZhbHVlOiBudW1iZXI7XG4gIGNsaWNrc0J5Q2F0ZWdvcnk6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIHJldmVudWVCeUNhdGVnb3J5OiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuICB0b3BQZXJmb3JtaW5nUHJvZHVjdHM6IEFmZmlsaWF0ZVByb2R1Y3RbXTtcbiAgcGVyZm9ybWFuY2VCeVNvdXJjZTogUmVjb3JkPHN0cmluZywge1xuICAgIGNsaWNrczogbnVtYmVyO1xuICAgIGNvbnZlcnNpb25zOiBudW1iZXI7XG4gICAgcmV2ZW51ZTogbnVtYmVyO1xuICAgIGNvbnZlcnNpb25SYXRlOiBudW1iZXI7XG4gIH0+O1xufVxuXG4vKipcbiAqIENvbXByZWhlbnNpdmUgQW1hem9uIEFmZmlsaWF0ZSBMaW5rcyBTZXJ2aWNlXG4gKiBIYW5kbGVzIGxpbmsgZ2VuZXJhdGlvbiwgdHJhY2tpbmcsIGFuYWx5dGljcywgYW5kIGNvbXBsaWFuY2VcbiAqL1xuZXhwb3J0IGNsYXNzIEFtYXpvbkFmZmlsaWF0ZVNlcnZpY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogQW1hem9uQWZmaWxpYXRlU2VydmljZTtcbiAgcHJpdmF0ZSBjbGlja0V2ZW50czogQWZmaWxpYXRlQ2xpY2tFdmVudFtdID0gW107XG4gIHByaXZhdGUgY29udmVyc2lvbkV2ZW50czogQWZmaWxpYXRlQ29udmVyc2lvbkV2ZW50W10gPSBbXTtcbiAgXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplVHJhY2tpbmcoKTtcbiAgfVxuICBcbiAgc3RhdGljIGdldEluc3RhbmNlKCk6IEFtYXpvbkFmZmlsaWF0ZVNlcnZpY2Uge1xuICAgIGlmICghQW1hem9uQWZmaWxpYXRlU2VydmljZS5pbnN0YW5jZSkge1xuICAgICAgQW1hem9uQWZmaWxpYXRlU2VydmljZS5pbnN0YW5jZSA9IG5ldyBBbWF6b25BZmZpbGlhdGVTZXJ2aWNlKCk7XG4gICAgfVxuICAgIHJldHVybiBBbWF6b25BZmZpbGlhdGVTZXJ2aWNlLmluc3RhbmNlO1xuICB9XG4gIFxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBhZmZpbGlhdGUgdHJhY2tpbmcgYW5kIGFuYWx5dGljc1xuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplVHJhY2tpbmcoKTogdm9pZCB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAvLyBMb2FkIGV4aXN0aW5nIGV2ZW50cyBmcm9tIGxvY2FsU3RvcmFnZVxuICAgICAgY29uc3Qgc3RvcmVkQ2xpY2tzID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjbHVlX2FmZmlsaWF0ZV9jbGlja3MnKTtcbiAgICAgIGNvbnN0IHN0b3JlZENvbnZlcnNpb25zID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2FjbHVlX2FmZmlsaWF0ZV9jb252ZXJzaW9ucycpO1xuICAgICAgXG4gICAgICBpZiAoc3RvcmVkQ2xpY2tzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy5jbGlja0V2ZW50cyA9IEpTT04ucGFyc2Uoc3RvcmVkQ2xpY2tzKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBsb2FkaW5nIGFmZmlsaWF0ZSBjbGljayBldmVudHM6JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChzdG9yZWRDb252ZXJzaW9ucykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHRoaXMuY29udmVyc2lvbkV2ZW50cyA9IEpTT04ucGFyc2Uoc3RvcmVkQ29udmVyc2lvbnMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgYWZmaWxpYXRlIGNvbnZlcnNpb24gZXZlbnRzOicsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDbGVhbiB1cCBvbGQgZXZlbnRzIChvbGRlciB0aGFuIDMwIGRheXMpXG4gICAgICB0aGlzLmNsZWFudXBPbGRFdmVudHMoKTtcbiAgICAgIFxuICAgICAgLy8gU2V0IHVwIHBlcmlvZGljIGNsZWFudXBcbiAgICAgIHNldEludGVydmFsKCgpID0+IHRoaXMuY2xlYW51cE9sZEV2ZW50cygpLCAyNCAqIDYwICogNjAgKiAxMDAwKTsgLy8gRGFpbHkgY2xlYW51cFxuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEdlbmVyYXRlIGFmZmlsaWF0ZSBsaW5rIHdpdGggY29tcHJlaGVuc2l2ZSB0cmFja2luZ1xuICAgKi9cbiAgZ2VuZXJhdGVBZmZpbGlhdGVMaW5rKFxuICAgIHByb2R1Y3RVcmw6IHN0cmluZyxcbiAgICBvcHRpb25zOiBBZmZpbGlhdGVMaW5rT3B0aW9ucyA9IHt9XG4gICk6IHN0cmluZyB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocHJvZHVjdFVybCk7XG4gICAgICBcbiAgICAgIC8vIEVuc3VyZSB3ZSdyZSB1c2luZyB0aGUgY29ycmVjdCBBbWF6b24gZG9tYWluXG4gICAgICBpZiAoIXRoaXMuaXNWYWxpZEFtYXpvblVybChwcm9kdWN0VXJsKSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ0ludmFsaWQgQW1hem9uIFVSTCBwcm92aWRlZDonLCBwcm9kdWN0VXJsKTtcbiAgICAgICAgcmV0dXJuIHByb2R1Y3RVcmw7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENvbnZlcnQgdG8gVUsgZG9tYWluIGlmIG5lZWRlZFxuICAgICAgaWYgKCF1cmwuaG9zdG5hbWUuaW5jbHVkZXMoJ2FtYXpvbi5jby51aycpKSB7XG4gICAgICAgIHVybC5ob3N0bmFtZSA9ICdhbWF6b24uY28udWsnO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBZGQgYXNzb2NpYXRlIHRhZ1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3RhZycsIG9wdGlvbnMuYXNzb2NpYXRlVGFnIHx8IGFtYXpvbkNvbmZpZy51ay5hc3NvY2lhdGVUYWcpO1xuICAgICAgXG4gICAgICAvLyBBZGQgdHJhY2tpbmcgcGFyYW1ldGVyc1xuICAgICAgaWYgKG9wdGlvbnMucmVmKSB7XG4gICAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCdyZWZfJywgb3B0aW9ucy5yZWYpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBVVE0gcGFyYW1ldGVycyBmb3IgYW5hbHl0aWNzXG4gICAgICBpZiAob3B0aW9ucy5jYW1wYWlnbikge1xuICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldCgndXRtX2NhbXBhaWduJywgb3B0aW9ucy5jYW1wYWlnbik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChvcHRpb25zLm1lZGl1bSkge1xuICAgICAgICB1cmwuc2VhcmNoUGFyYW1zLnNldCgndXRtX21lZGl1bScsIG9wdGlvbnMubWVkaXVtKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKG9wdGlvbnMuc291cmNlKSB7XG4gICAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCd1dG1fc291cmNlJywgb3B0aW9ucy5zb3VyY2UpO1xuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAob3B0aW9ucy50ZXJtKSB7XG4gICAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCd1dG1fdGVybScsIG9wdGlvbnMudGVybSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChvcHRpb25zLmNvbnRlbnQpIHtcbiAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3V0bV9jb250ZW50Jywgb3B0aW9ucy5jb250ZW50KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQWRkIGN1c3RvbSBwYXJhbWV0ZXJzXG4gICAgICBpZiAob3B0aW9ucy5jdXN0b21QYXJhbWV0ZXJzKSB7XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKG9wdGlvbnMuY3VzdG9tUGFyYW1ldGVycykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBZGQgdW5pcXVlIHRyYWNraW5nIGlkZW50aWZpZXJcbiAgICAgIGNvbnN0IHRyYWNraW5nSWQgPSB0aGlzLmdlbmVyYXRlVHJhY2tpbmdJZCgpO1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2dzX3RyYWNrJywgdHJhY2tpbmdJZCk7XG4gICAgICBcbiAgICAgIC8vIEFkZCB0aW1lc3RhbXBcbiAgICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCd0aW1lc3RhbXAnLCBEYXRlLm5vdygpLnRvU3RyaW5nKCkpO1xuICAgICAgXG4gICAgICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdlbmVyYXRpbmcgYWZmaWxpYXRlIGxpbms6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHByb2R1Y3RVcmw7XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogR2VuZXJhdGUgQW1hem9uIHNlYXJjaCBsaW5rIHdpdGggYWZmaWxpYXRlIHRyYWNraW5nXG4gICAqL1xuICBnZW5lcmF0ZVNlYXJjaExpbmsoXG4gICAgc2VhcmNoVGVybTogc3RyaW5nLFxuICAgIGNhdGVnb3J5Pzogc3RyaW5nLFxuICAgIG9wdGlvbnM6IEFmZmlsaWF0ZUxpbmtPcHRpb25zID0ge31cbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCBiYXNlVXJsID0gJ2h0dHBzOi8vYW1hem9uLmNvLnVrL3MnO1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoYmFzZVVybCk7XG4gICAgXG4gICAgLy8gU2VhcmNoIHBhcmFtZXRlcnNcbiAgICB1cmwuc2VhcmNoUGFyYW1zLnNldCgnaycsIHNlYXJjaFRlcm0pO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCd0YWcnLCBvcHRpb25zLmFzc29jaWF0ZVRhZyB8fCBhbWF6b25Db25maWcudWsuYXNzb2NpYXRlVGFnKTtcbiAgICBcbiAgICAvLyBDYXRlZ29yeSBmaWx0ZXJcbiAgICBpZiAoY2F0ZWdvcnkgJiYgYW1hem9uQ29uZmlnLnByb2R1Y3RDYXRlZ29yaWVzW2NhdGVnb3J5XSkge1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ2knLCBhbWF6b25Db25maWcucHJvZHVjdENhdGVnb3JpZXNbY2F0ZWdvcnldKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVHJhY2tpbmcgcGFyYW1ldGVyc1xuICAgIGlmIChvcHRpb25zLnJlZikge1xuICAgICAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3JlZicsIG9wdGlvbnMucmVmKTtcbiAgICB9XG4gICAgXG4gICAgLy8gVVRNIHBhcmFtZXRlcnNcbiAgICBpZiAob3B0aW9ucy5jYW1wYWlnbikgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3V0bV9jYW1wYWlnbicsIG9wdGlvbnMuY2FtcGFpZ24pO1xuICAgIGlmIChvcHRpb25zLm1lZGl1bSkgdXJsLnNlYXJjaFBhcmFtcy5zZXQoJ3V0bV9tZWRpdW0nLCBvcHRpb25zLm1lZGl1bSk7XG4gICAgaWYgKG9wdGlvbnMuc291cmNlKSB1cmwuc2VhcmNoUGFyYW1zLnNldCgndXRtX3NvdXJjZScsIG9wdGlvbnMuc291cmNlKTtcbiAgICBcbiAgICAvLyBBZGQgdHJhY2tpbmcgaWRlbnRpZmllclxuICAgIGNvbnN0IHRyYWNraW5nSWQgPSB0aGlzLmdlbmVyYXRlVHJhY2tpbmdJZCgpO1xuICAgIHVybC5zZWFyY2hQYXJhbXMuc2V0KCdnc190cmFjaycsIHRyYWNraW5nSWQpO1xuICAgIFxuICAgIHJldHVybiB1cmwudG9TdHJpbmcoKTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIFRyYWNrIGFmZmlsaWF0ZSBsaW5rIGNsaWNrIHdpdGggY29tcHJlaGVuc2l2ZSBhbmFseXRpY3NcbiAgICovXG4gIGFzeW5jIHRyYWNrQWZmaWxpYXRlQ2xpY2soZXZlbnQ6IE9taXQ8QWZmaWxpYXRlQ2xpY2tFdmVudCwgJ3RpbWVzdGFtcCc+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY2xpY2tFdmVudDogQWZmaWxpYXRlQ2xpY2tFdmVudCA9IHtcbiAgICAgIC4uLmV2ZW50LFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgdXNlckFnZW50OiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IG5hdmlnYXRvci51c2VyQWdlbnQgOiB1bmRlZmluZWQsXG4gICAgICByZWZlcnJlcjogdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyBkb2N1bWVudC5yZWZlcnJlciA6IHVuZGVmaW5lZCxcbiAgICB9O1xuICAgIFxuICAgIC8vIFN0b3JlIGV2ZW50IGxvY2FsbHlcbiAgICB0aGlzLmNsaWNrRXZlbnRzLnB1c2goY2xpY2tFdmVudCk7XG4gICAgdGhpcy5wZXJzaXN0Q2xpY2tFdmVudHMoKTtcbiAgICBcbiAgICAvLyBTZW5kIHRvIGFuYWx5dGljcyBzZXJ2aWNlXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFuYWx5dGljcy50cmFjaygnYWZmaWxpYXRlX2xpbmtfY2xpY2tlZCcsIHtcbiAgICAgICAgYWZmaWxpYXRlX3Byb2R1Y3RfaWQ6IGV2ZW50LnByb2R1Y3RJZCxcbiAgICAgICAgYWZmaWxpYXRlX2FzaW46IGV2ZW50LmFzaW4sXG4gICAgICAgIGFmZmlsaWF0ZV9jYXRlZ29yeTogZXZlbnQuY2F0ZWdvcnksXG4gICAgICAgIGFmZmlsaWF0ZV9wcmljZTogZXZlbnQucHJpY2UsXG4gICAgICAgIGFmZmlsaWF0ZV9jdXJyZW5jeTogZXZlbnQuY3VycmVuY3ksXG4gICAgICAgIGFmZmlsaWF0ZV9zb3VyY2U6IGV2ZW50LnNvdXJjZSxcbiAgICAgICAgYWZmaWxpYXRlX3VybDogZXZlbnQuYWZmaWxpYXRlVXJsLFxuICAgICAgICBvcmlnaW5hbF91cmw6IGV2ZW50Lm9yaWdpbmFsVXJsLFxuICAgICAgICB1c2VyX2lkOiBldmVudC51c2VySWQsXG4gICAgICAgIHNlc3Npb25faWQ6IGV2ZW50LnNlc3Npb25JZCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZW5kaW5nIGFmZmlsaWF0ZSBjbGljayB0byBhbmFseXRpY3M6JywgZXJyb3IpO1xuICAgIH1cbiAgICBcbiAgICAvLyBTZW5kIHRvIGJhY2tlbmQgZm9yIHNlcnZlci1zaWRlIHRyYWNraW5nXG4gICAgaWYgKGNvbmZpZy5mZWF0dXJlcy5hZmZpbGlhdGVUcmFja2luZykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZmV0Y2goYCR7Y29uZmlnLmFwaVVybH0vYXBpL3YxL2FuYWx5dGljcy9hZmZpbGlhdGUvY2xpY2tgLCB7XG4gICAgICAgICAgbWV0aG9kOiAnUE9TVCcsXG4gICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGNsaWNrRXZlbnQpLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNlbmRpbmcgYWZmaWxpYXRlIGNsaWNrIHRvIGJhY2tlbmQ6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIFRyYWNrIGFmZmlsaWF0ZSBjb252ZXJzaW9uICh3aGVuIHVzZXIgbWFrZXMgYSBwdXJjaGFzZSlcbiAgICovXG4gIGFzeW5jIHRyYWNrQWZmaWxpYXRlQ29udmVyc2lvbihldmVudDogT21pdDxBZmZpbGlhdGVDb252ZXJzaW9uRXZlbnQsICdjb252ZXJzaW9uVGltZXN0YW1wJz4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb252ZXJzaW9uRXZlbnQ6IEFmZmlsaWF0ZUNvbnZlcnNpb25FdmVudCA9IHtcbiAgICAgIC4uLmV2ZW50LFxuICAgICAgY29udmVyc2lvblRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICB9O1xuICAgIFxuICAgIC8vIFN0b3JlIGV2ZW50IGxvY2FsbHlcbiAgICB0aGlzLmNvbnZlcnNpb25FdmVudHMucHVzaChjb252ZXJzaW9uRXZlbnQpO1xuICAgIHRoaXMucGVyc2lzdENvbnZlcnNpb25FdmVudHMoKTtcbiAgICBcbiAgICAvLyBTZW5kIHRvIGFuYWx5dGljcyBzZXJ2aWNlXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGFuYWx5dGljcy50cmFjaygnYWZmaWxpYXRlX2NvbnZlcnNpb24nLCB7XG4gICAgICAgIGFmZmlsaWF0ZV9vcmRlcl9pZDogZXZlbnQub3JkZXJJZCxcbiAgICAgICAgYWZmaWxpYXRlX3Byb2R1Y3RfaWQ6IGV2ZW50LnByb2R1Y3RJZCxcbiAgICAgICAgYWZmaWxpYXRlX2FzaW46IGV2ZW50LmFzaW4sXG4gICAgICAgIGFmZmlsaWF0ZV9yZXZlbnVlOiBldmVudC5yZXZlbnVlLFxuICAgICAgICBhZmZpbGlhdGVfY29tbWlzc2lvbjogZXZlbnQuY29tbWlzc2lvbixcbiAgICAgICAgYWZmaWxpYXRlX2N1cnJlbmN5OiBldmVudC5jdXJyZW5jeSxcbiAgICAgICAgYWZmaWxpYXRlX3F1YW50aXR5OiBldmVudC5xdWFudGl0eSxcbiAgICAgICAgYWZmaWxpYXRlX2NhdGVnb3J5OiBldmVudC5jYXRlZ29yeSxcbiAgICAgICAgYWZmaWxpYXRlX3VybDogZXZlbnQuYWZmaWxpYXRlVXJsLFxuICAgICAgICBjb252ZXJzaW9uX3RpbWVfbWludXRlczogKGNvbnZlcnNpb25FdmVudC5jb252ZXJzaW9uVGltZXN0YW1wIC0gZXZlbnQuY2xpY2tUaW1lc3RhbXApIC8gKDEwMDAgKiA2MCksXG4gICAgICAgIHVzZXJfaWQ6IGV2ZW50LnVzZXJJZCxcbiAgICAgICAgc2Vzc2lvbl9pZDogZXZlbnQuc2Vzc2lvbklkLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNlbmRpbmcgYWZmaWxpYXRlIGNvbnZlcnNpb24gdG8gYW5hbHl0aWNzOicsIGVycm9yKTtcbiAgICB9XG4gICAgXG4gICAgLy8gU2VuZCB0byBiYWNrZW5kXG4gICAgaWYgKGNvbmZpZy5mZWF0dXJlcy5hZmZpbGlhdGVUcmFja2luZykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZmV0Y2goYCR7Y29uZmlnLmFwaVVybH0vYXBpL3YxL2FuYWx5dGljcy9hZmZpbGlhdGUvY29udmVyc2lvbmAsIHtcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoY29udmVyc2lvbkV2ZW50KSxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZW5kaW5nIGFmZmlsaWF0ZSBjb252ZXJzaW9uIHRvIGJhY2tlbmQ6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEdldCBjb21wcmVoZW5zaXZlIGFmZmlsaWF0ZSBhbmFseXRpY3NcbiAgICovXG4gIGdldEFuYWx5dGljcyh0aW1lZnJhbWU6ICdkYXknIHwgJ3dlZWsnIHwgJ21vbnRoJyB8ICd5ZWFyJyB8ICdhbGwnID0gJ21vbnRoJyk6IEFmZmlsaWF0ZUFuYWx5dGljcyB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCB0aW1lZnJhbU1zID0ge1xuICAgICAgZGF5OiAyNCAqIDYwICogNjAgKiAxMDAwLFxuICAgICAgd2VlazogNyAqIDI0ICogNjAgKiA2MCAqIDEwMDAsXG4gICAgICBtb250aDogMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwLFxuICAgICAgeWVhcjogMzY1ICogMjQgKiA2MCAqIDYwICogMTAwMCxcbiAgICAgIGFsbDogSW5maW5pdHksXG4gICAgfTtcbiAgICBcbiAgICBjb25zdCBjdXRvZmYgPSBub3cgLSB0aW1lZnJhbU1zW3RpbWVmcmFtZV07XG4gICAgXG4gICAgLy8gRmlsdGVyIGV2ZW50cyBieSB0aW1lZnJhbWVcbiAgICBjb25zdCByZWxldmFudENsaWNrcyA9IHRoaXMuY2xpY2tFdmVudHMuZmlsdGVyKGV2ZW50ID0+IGV2ZW50LnRpbWVzdGFtcCA+PSBjdXRvZmYpO1xuICAgIGNvbnN0IHJlbGV2YW50Q29udmVyc2lvbnMgPSB0aGlzLmNvbnZlcnNpb25FdmVudHMuZmlsdGVyKGV2ZW50ID0+IGV2ZW50LmNvbnZlcnNpb25UaW1lc3RhbXAgPj0gY3V0b2ZmKTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgbWV0cmljc1xuICAgIGNvbnN0IHRvdGFsQ2xpY2tzID0gcmVsZXZhbnRDbGlja3MubGVuZ3RoO1xuICAgIGNvbnN0IHRvdGFsQ29udmVyc2lvbnMgPSByZWxldmFudENvbnZlcnNpb25zLmxlbmd0aDtcbiAgICBjb25zdCB0b3RhbFJldmVudWUgPSByZWxldmFudENvbnZlcnNpb25zLnJlZHVjZSgoc3VtLCBldmVudCkgPT4gc3VtICsgZXZlbnQucmV2ZW51ZSwgMCk7XG4gICAgY29uc3QgdG90YWxDb21taXNzaW9uID0gcmVsZXZhbnRDb252ZXJzaW9ucy5yZWR1Y2UoKHN1bSwgZXZlbnQpID0+IHN1bSArIGV2ZW50LmNvbW1pc3Npb24sIDApO1xuICAgIGNvbnN0IGNvbnZlcnNpb25SYXRlID0gdG90YWxDbGlja3MgPiAwID8gdG90YWxDb252ZXJzaW9ucyAvIHRvdGFsQ2xpY2tzIDogMDtcbiAgICBjb25zdCBhdmVyYWdlT3JkZXJWYWx1ZSA9IHRvdGFsQ29udmVyc2lvbnMgPiAwID8gdG90YWxSZXZlbnVlIC8gdG90YWxDb252ZXJzaW9ucyA6IDA7XG4gICAgXG4gICAgLy8gQ2xpY2tzIGJ5IGNhdGVnb3J5XG4gICAgY29uc3QgY2xpY2tzQnlDYXRlZ29yeTogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgIHJlbGV2YW50Q2xpY2tzLmZvckVhY2goZXZlbnQgPT4ge1xuICAgICAgaWYgKGV2ZW50LmNhdGVnb3J5KSB7XG4gICAgICAgIGNsaWNrc0J5Q2F0ZWdvcnlbZXZlbnQuY2F0ZWdvcnldID0gKGNsaWNrc0J5Q2F0ZWdvcnlbZXZlbnQuY2F0ZWdvcnldIHx8IDApICsgMTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICAvLyBSZXZlbnVlIGJ5IGNhdGVnb3J5XG4gICAgY29uc3QgcmV2ZW51ZUJ5Q2F0ZWdvcnk6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICByZWxldmFudENvbnZlcnNpb25zLmZvckVhY2goZXZlbnQgPT4ge1xuICAgICAgaWYgKGV2ZW50LmNhdGVnb3J5KSB7XG4gICAgICAgIHJldmVudWVCeUNhdGVnb3J5W2V2ZW50LmNhdGVnb3J5XSA9IChyZXZlbnVlQnlDYXRlZ29yeVtldmVudC5jYXRlZ29yeV0gfHwgMCkgKyBldmVudC5yZXZlbnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIC8vIFBlcmZvcm1hbmNlIGJ5IHNvdXJjZVxuICAgIGNvbnN0IHBlcmZvcm1hbmNlQnlTb3VyY2U6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcbiAgICBjb25zdCBjbGlja3NCeVNvdXJjZTogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgIGNvbnN0IGNvbnZlcnNpb25zQnlTb3VyY2U6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICBjb25zdCByZXZlbnVlQnlTb3VyY2U6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICBcbiAgICByZWxldmFudENsaWNrcy5mb3JFYWNoKGV2ZW50ID0+IHtcbiAgICAgIGNsaWNrc0J5U291cmNlW2V2ZW50LnNvdXJjZV0gPSAoY2xpY2tzQnlTb3VyY2VbZXZlbnQuc291cmNlXSB8fCAwKSArIDE7XG4gICAgfSk7XG4gICAgXG4gICAgcmVsZXZhbnRDb252ZXJzaW9ucy5mb3JFYWNoKGV2ZW50ID0+IHtcbiAgICAgIC8vIEZpbmQgY29ycmVzcG9uZGluZyBjbGljayBldmVudFxuICAgICAgY29uc3QgY2xpY2tFdmVudCA9IHJlbGV2YW50Q2xpY2tzLmZpbmQoY2xpY2sgPT4gXG4gICAgICAgIGNsaWNrLnByb2R1Y3RJZCA9PT0gZXZlbnQucHJvZHVjdElkICYmIFxuICAgICAgICBjbGljay50aW1lc3RhbXAgPD0gZXZlbnQuY2xpY2tUaW1lc3RhbXBcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmIChjbGlja0V2ZW50KSB7XG4gICAgICAgIGNvbnZlcnNpb25zQnlTb3VyY2VbY2xpY2tFdmVudC5zb3VyY2VdID0gKGNvbnZlcnNpb25zQnlTb3VyY2VbY2xpY2tFdmVudC5zb3VyY2VdIHx8IDApICsgMTtcbiAgICAgICAgcmV2ZW51ZUJ5U291cmNlW2NsaWNrRXZlbnQuc291cmNlXSA9IChyZXZlbnVlQnlTb3VyY2VbY2xpY2tFdmVudC5zb3VyY2VdIHx8IDApICsgZXZlbnQucmV2ZW51ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBPYmplY3Qua2V5cyhjbGlja3NCeVNvdXJjZSkuZm9yRWFjaChzb3VyY2UgPT4ge1xuICAgICAgY29uc3QgY2xpY2tzID0gY2xpY2tzQnlTb3VyY2Vbc291cmNlXSB8fCAwO1xuICAgICAgY29uc3QgY29udmVyc2lvbnMgPSBjb252ZXJzaW9uc0J5U291cmNlW3NvdXJjZV0gfHwgMDtcbiAgICAgIGNvbnN0IHJldmVudWUgPSByZXZlbnVlQnlTb3VyY2Vbc291cmNlXSB8fCAwO1xuICAgICAgXG4gICAgICBwZXJmb3JtYW5jZUJ5U291cmNlW3NvdXJjZV0gPSB7XG4gICAgICAgIGNsaWNrcyxcbiAgICAgICAgY29udmVyc2lvbnMsXG4gICAgICAgIHJldmVudWUsXG4gICAgICAgIGNvbnZlcnNpb25SYXRlOiBjbGlja3MgPiAwID8gY29udmVyc2lvbnMgLyBjbGlja3MgOiAwLFxuICAgICAgfTtcbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxDbGlja3MsXG4gICAgICB0b3RhbENvbnZlcnNpb25zLFxuICAgICAgdG90YWxSZXZlbnVlLFxuICAgICAgdG90YWxDb21taXNzaW9uLFxuICAgICAgY29udmVyc2lvblJhdGUsXG4gICAgICBhdmVyYWdlT3JkZXJWYWx1ZSxcbiAgICAgIGNsaWNrc0J5Q2F0ZWdvcnksXG4gICAgICByZXZlbnVlQnlDYXRlZ29yeSxcbiAgICAgIHRvcFBlcmZvcm1pbmdQcm9kdWN0czogW10sIC8vIFRPRE86IEltcGxlbWVudCBiYXNlZCBvbiBjb252ZXJzaW9uIGRhdGFcbiAgICAgIHBlcmZvcm1hbmNlQnlTb3VyY2UsXG4gICAgfTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIEV4dHJhY3QgQVNJTiBmcm9tIEFtYXpvbiBwcm9kdWN0IFVSTFxuICAgKi9cbiAgZXh0cmFjdEFTSU4ocHJvZHVjdFVybDogc3RyaW5nKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGFzaW5QYXR0ZXJucyA9IFtcbiAgICAgICAgL1xcL2RwXFwvKFtBLVowLTldezEwfSkvLFxuICAgICAgICAvXFwvZ3BcXC9wcm9kdWN0XFwvKFtBLVowLTldezEwfSkvLFxuICAgICAgICAvXFwvcHJvZHVjdFxcLyhbQS1aMC05XXsxMH0pLyxcbiAgICAgICAgL1xcL0FTSU5cXC8oW0EtWjAtOV17MTB9KS8sXG4gICAgICAgIC9hc2luPShbQS1aMC05XXsxMH0pL2ksXG4gICAgICAgIC9cXC8oW0EtWjAtOV17MTB9KSg/OlxcL3xcXD98JCkvLFxuICAgICAgXTtcbiAgICAgIFxuICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIGFzaW5QYXR0ZXJucykge1xuICAgICAgICBjb25zdCBtYXRjaCA9IHByb2R1Y3RVcmwubWF0Y2gocGF0dGVybik7XG4gICAgICAgIGlmIChtYXRjaCAmJiBtYXRjaFsxXSkge1xuICAgICAgICAgIHJldHVybiBtYXRjaFsxXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZXh0cmFjdGluZyBBU0lOOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIFZhbGlkYXRlIEFtYXpvbiBVUkxcbiAgICovXG4gIGlzVmFsaWRBbWF6b25VcmwodXJsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXJsT2JqID0gbmV3IFVSTCh1cmwpO1xuICAgICAgY29uc3QgdmFsaWREb21haW5zID0gW1xuICAgICAgICAnYW1hem9uLmNvLnVrJyxcbiAgICAgICAgJ2FtYXpvbi5jb20nLFxuICAgICAgICAnYW1hem9uLmRlJyxcbiAgICAgICAgJ2FtYXpvbi5mcicsXG4gICAgICAgICdhbWF6b24uaXQnLFxuICAgICAgICAnYW1hem9uLmVzJyxcbiAgICAgICAgJ2FtYXpvbi5jYScsXG4gICAgICAgICdhbWF6b24uY29tLmF1JyxcbiAgICAgICAgJ2FtYXpvbi5jby5qcCcsXG4gICAgICAgICdhbWF6b24uY29tLmJyJyxcbiAgICAgICAgJ2FtYXpvbi5pbicsXG4gICAgICAgICdhbWF6b24uY29tLm14JyxcbiAgICAgICAgJ2FtYXpvbi5jbicsXG4gICAgICAgICdhbWF6b24uc2cnLFxuICAgICAgICAnYW1hem9uLmFlJyxcbiAgICAgICAgJ2FtYXpvbi5ubCcsXG4gICAgICAgICdhbWF6b24uc2UnLFxuICAgICAgICAnYW1hem9uLnBsJyxcbiAgICAgIF07XG4gICAgICBcbiAgICAgIHJldHVybiB2YWxpZERvbWFpbnMuc29tZShkb21haW4gPT4gdXJsT2JqLmhvc3RuYW1lLmluY2x1ZGVzKGRvbWFpbikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogR2V0IGNvbW1pc3Npb24gcmF0ZSBmb3IgcHJvZHVjdCBjYXRlZ29yeVxuICAgKi9cbiAgZ2V0Q29tbWlzc2lvblJhdGUoY2F0ZWdvcnk6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3Qgbm9ybWFsaXplZENhdGVnb3J5ID0gY2F0ZWdvcnkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9cXHMrL2csICcnKTtcbiAgICBcbiAgICBjb25zdCBjYXRlZ29yeU1hcHBpbmdzOiBSZWNvcmQ8c3RyaW5nLCBrZXlvZiB0eXBlb2YgYW1hem9uQ29uZmlnLmNvbW1pc3Npb25SYXRlcz4gPSB7XG4gICAgICAnZWxlY3Ryb25pY3MnOiAnZWxlY3Ryb25pY3MnLFxuICAgICAgJ2NvbXB1dGVycyc6ICdlbGVjdHJvbmljcycsXG4gICAgICAnbW9iaWxlJzogJ2VsZWN0cm9uaWNzJyxcbiAgICAgICdmYXNoaW9uJzogJ2Zhc2hpb24nLFxuICAgICAgJ2Nsb3RoaW5nJzogJ2Zhc2hpb24nLFxuICAgICAgJ3Nob2VzJzogJ2Zhc2hpb24nLFxuICAgICAgJ2FjY2Vzc29yaWVzJzogJ2Zhc2hpb24nLFxuICAgICAgJ2hvbWVhbmRnYXJkZW4nOiAnaG9tZUFuZEdhcmRlbicsXG4gICAgICAnaG9tZSc6ICdob21lQW5kR2FyZGVuJyxcbiAgICAgICdnYXJkZW4nOiAnaG9tZUFuZEdhcmRlbicsXG4gICAgICAnZnVybml0dXJlJzogJ2hvbWVBbmRHYXJkZW4nLFxuICAgICAgJ2tpdGNoZW4nOiAnaG9tZUFuZEdhcmRlbicsXG4gICAgICAnc3BvcnRzYW5kb3V0ZG9vcnMnOiAnc3BvcnRzQW5kT3V0ZG9vcnMnLFxuICAgICAgJ3Nwb3J0cyc6ICdzcG9ydHNBbmRPdXRkb29ycycsXG4gICAgICAnZml0bmVzcyc6ICdzcG9ydHNBbmRPdXRkb29ycycsXG4gICAgICAnb3V0ZG9vcic6ICdzcG9ydHNBbmRPdXRkb29ycycsXG4gICAgICAnYm9va3MnOiAnYm9va3MnLFxuICAgICAgJ2Vib29rcyc6ICdib29rcycsXG4gICAgICAna2luZGxlJzogJ2Jvb2tzJyxcbiAgICAgICd0b3lzJzogJ3RveXMnLFxuICAgICAgJ3RveXNnYW1lcyc6ICd0b3lzJyxcbiAgICAgICdnYW1lcyc6ICd0b3lzJyxcbiAgICAgICd2aWRlb2dhbWVzJzogJ3RveXMnLFxuICAgICAgJ2JlYXV0eSc6ICdiZWF1dHlBbmRQZXJzb25hbENhcmUnLFxuICAgICAgJ2JlYXV0eWFuZHBlcnNvbmFsY2FyZSc6ICdiZWF1dHlBbmRQZXJzb25hbENhcmUnLFxuICAgICAgJ3BlcnNvbmFsY2FyZSc6ICdiZWF1dHlBbmRQZXJzb25hbENhcmUnLFxuICAgICAgJ2hlYWx0aCc6ICdiZWF1dHlBbmRQZXJzb25hbENhcmUnLFxuICAgICAgJ2F1dG9tb3RpdmUnOiAnYXV0b21vdGl2ZScsXG4gICAgICAnY2FyJzogJ2F1dG9tb3RpdmUnLFxuICAgICAgJ21vdG9yY3ljbGUnOiAnYXV0b21vdGl2ZScsXG4gICAgICAnaW5kdXN0cmlhbCc6ICdpbmR1c3RyaWFsJyxcbiAgICAgICd0b29scyc6ICdpbmR1c3RyaWFsJyxcbiAgICAgICdidXNpbmVzcyc6ICdpbmR1c3RyaWFsJyxcbiAgICB9O1xuICAgIFxuICAgIGNvbnN0IG1hcHBlZENhdGVnb3J5ID0gY2F0ZWdvcnlNYXBwaW5nc1tub3JtYWxpemVkQ2F0ZWdvcnldO1xuICAgIHJldHVybiBhbWF6b25Db25maWcuY29tbWlzc2lvblJhdGVzW21hcHBlZENhdGVnb3J5XSB8fCBhbWF6b25Db25maWcuY29tbWlzc2lvblJhdGVzLmRlZmF1bHQ7XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSB1bmlxdWUgdHJhY2tpbmcgaWRlbnRpZmllclxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVRyYWNraW5nSWQoKTogc3RyaW5nIHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KTtcbiAgICBjb25zdCByYW5kb20gPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSk7XG4gICAgcmV0dXJuIGBnc18ke3RpbWVzdGFtcH1fJHtyYW5kb219YDtcbiAgfVxuICBcbiAgLyoqXG4gICAqIFBlcnNpc3QgY2xpY2sgZXZlbnRzIHRvIGxvY2FsU3RvcmFnZVxuICAgKi9cbiAgcHJpdmF0ZSBwZXJzaXN0Q2xpY2tFdmVudHMoKTogdm9pZCB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0cnkge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYWNsdWVfYWZmaWxpYXRlX2NsaWNrcycsIEpTT04uc3RyaW5naWZ5KHRoaXMuY2xpY2tFdmVudHMpKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHBlcnNpc3RpbmcgYWZmaWxpYXRlIGNsaWNrIGV2ZW50czonLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogUGVyc2lzdCBjb252ZXJzaW9uIGV2ZW50cyB0byBsb2NhbFN0b3JhZ2VcbiAgICovXG4gIHByaXZhdGUgcGVyc2lzdENvbnZlcnNpb25FdmVudHMoKTogdm9pZCB7XG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICB0cnkge1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYWNsdWVfYWZmaWxpYXRlX2NvbnZlcnNpb25zJywgSlNPTi5zdHJpbmdpZnkodGhpcy5jb252ZXJzaW9uRXZlbnRzKSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwZXJzaXN0aW5nIGFmZmlsaWF0ZSBjb252ZXJzaW9uIGV2ZW50czonLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogQ2xlYW4gdXAgb2xkIGV2ZW50cyAob2xkZXIgdGhhbiAzMCBkYXlzKVxuICAgKi9cbiAgcHJpdmF0ZSBjbGVhbnVwT2xkRXZlbnRzKCk6IHZvaWQge1xuICAgIGNvbnN0IHRoaXJ0eURheXNBZ28gPSBEYXRlLm5vdygpIC0gKDMwICogMjQgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgXG4gICAgdGhpcy5jbGlja0V2ZW50cyA9IHRoaXMuY2xpY2tFdmVudHMuZmlsdGVyKGV2ZW50ID0+IGV2ZW50LnRpbWVzdGFtcCA+PSB0aGlydHlEYXlzQWdvKTtcbiAgICB0aGlzLmNvbnZlcnNpb25FdmVudHMgPSB0aGlzLmNvbnZlcnNpb25FdmVudHMuZmlsdGVyKGV2ZW50ID0+IGV2ZW50LmNvbnZlcnNpb25UaW1lc3RhbXAgPj0gdGhpcnR5RGF5c0Fnbyk7XG4gICAgXG4gICAgdGhpcy5wZXJzaXN0Q2xpY2tFdmVudHMoKTtcbiAgICB0aGlzLnBlcnNpc3RDb252ZXJzaW9uRXZlbnRzKCk7XG4gIH1cbn1cblxuLy8gRXhwb3J0IHNpbmdsZXRvbiBpbnN0YW5jZVxuZXhwb3J0IGNvbnN0IGFmZmlsaWF0ZVNlcnZpY2UgPSBBbWF6b25BZmZpbGlhdGVTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG5cbi8vIEV4cG9ydCBjb252ZW5pZW5jZSBmdW5jdGlvbnNcbmV4cG9ydCBjb25zdCBnZW5lcmF0ZUFmZmlsaWF0ZUxpbmsgPSAodXJsOiBzdHJpbmcsIG9wdGlvbnM/OiBBZmZpbGlhdGVMaW5rT3B0aW9ucykgPT4gXG4gIGFmZmlsaWF0ZVNlcnZpY2UuZ2VuZXJhdGVBZmZpbGlhdGVMaW5rKHVybCwgb3B0aW9ucyk7XG5cbmV4cG9ydCBjb25zdCBnZW5lcmF0ZVNlYXJjaExpbmsgPSAoc2VhcmNoVGVybTogc3RyaW5nLCBjYXRlZ29yeT86IHN0cmluZywgb3B0aW9ucz86IEFmZmlsaWF0ZUxpbmtPcHRpb25zKSA9PiBcbiAgYWZmaWxpYXRlU2VydmljZS5nZW5lcmF0ZVNlYXJjaExpbmsoc2VhcmNoVGVybSwgY2F0ZWdvcnksIG9wdGlvbnMpO1xuXG5leHBvcnQgY29uc3QgdHJhY2tBZmZpbGlhdGVDbGljayA9IChldmVudDogT21pdDxBZmZpbGlhdGVDbGlja0V2ZW50LCAndGltZXN0YW1wJz4pID0+IFxuICBhZmZpbGlhdGVTZXJ2aWNlLnRyYWNrQWZmaWxpYXRlQ2xpY2soZXZlbnQpO1xuXG5leHBvcnQgY29uc3QgdHJhY2tBZmZpbGlhdGVDb252ZXJzaW9uID0gKGV2ZW50OiBPbWl0PEFmZmlsaWF0ZUNvbnZlcnNpb25FdmVudCwgJ2NvbnZlcnNpb25UaW1lc3RhbXAnPikgPT4gXG4gIGFmZmlsaWF0ZVNlcnZpY2UudHJhY2tBZmZpbGlhdGVDb252ZXJzaW9uKGV2ZW50KTtcblxuZXhwb3J0IGNvbnN0IGV4dHJhY3RBU0lOID0gKHVybDogc3RyaW5nKSA9PiBhZmZpbGlhdGVTZXJ2aWNlLmV4dHJhY3RBU0lOKHVybCk7XG5cbmV4cG9ydCBjb25zdCBpc1ZhbGlkQW1hem9uVXJsID0gKHVybDogc3RyaW5nKSA9PiBhZmZpbGlhdGVTZXJ2aWNlLmlzVmFsaWRBbWF6b25VcmwodXJsKTtcblxuZXhwb3J0IGNvbnN0IGdldENvbW1pc3Npb25SYXRlID0gKGNhdGVnb3J5OiBzdHJpbmcpID0+IGFmZmlsaWF0ZVNlcnZpY2UuZ2V0Q29tbWlzc2lvblJhdGUoY2F0ZWdvcnkpO1xuXG5leHBvcnQgY29uc3QgZ2V0QWZmaWxpYXRlQW5hbHl0aWNzID0gKHRpbWVmcmFtZT86ICdkYXknIHwgJ3dlZWsnIHwgJ21vbnRoJyB8ICd5ZWFyJyB8ICdhbGwnKSA9PiBcbiAgYWZmaWxpYXRlU2VydmljZS5nZXRBbmFseXRpY3ModGltZWZyYW1lKTsiXSwibmFtZXMiOlsiQW1hem9uQWZmaWxpYXRlU2VydmljZSIsImFmZmlsaWF0ZVNlcnZpY2UiLCJleHRyYWN0QVNJTiIsImdlbmVyYXRlQWZmaWxpYXRlTGluayIsImdlbmVyYXRlU2VhcmNoTGluayIsImdldEFmZmlsaWF0ZUFuYWx5dGljcyIsImdldENvbW1pc3Npb25SYXRlIiwiaXNWYWxpZEFtYXpvblVybCIsInRyYWNrQWZmaWxpYXRlQ2xpY2siLCJ0cmFja0FmZmlsaWF0ZUNvbnZlcnNpb24iLCJjbGlja0V2ZW50cyIsImNvbnZlcnNpb25FdmVudHMiLCJpbml0aWFsaXplVHJhY2tpbmciLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwid2luZG93Iiwic3RvcmVkQ2xpY2tzIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInN0b3JlZENvbnZlcnNpb25zIiwiSlNPTiIsInBhcnNlIiwiZXJyb3IiLCJjb25zb2xlIiwiY2xlYW51cE9sZEV2ZW50cyIsInNldEludGVydmFsIiwicHJvZHVjdFVybCIsIm9wdGlvbnMiLCJ1cmwiLCJVUkwiLCJ3YXJuIiwiaG9zdG5hbWUiLCJpbmNsdWRlcyIsInNlYXJjaFBhcmFtcyIsInNldCIsImFzc29jaWF0ZVRhZyIsImFtYXpvbkNvbmZpZyIsInVrIiwicmVmIiwiY2FtcGFpZ24iLCJtZWRpdW0iLCJzb3VyY2UiLCJ0ZXJtIiwiY29udGVudCIsImN1c3RvbVBhcmFtZXRlcnMiLCJPYmplY3QiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImtleSIsInZhbHVlIiwidHJhY2tpbmdJZCIsImdlbmVyYXRlVHJhY2tpbmdJZCIsIkRhdGUiLCJub3ciLCJ0b1N0cmluZyIsInNlYXJjaFRlcm0iLCJjYXRlZ29yeSIsImJhc2VVcmwiLCJwcm9kdWN0Q2F0ZWdvcmllcyIsImV2ZW50IiwiY2xpY2tFdmVudCIsInRpbWVzdGFtcCIsInVzZXJBZ2VudCIsIm5hdmlnYXRvciIsInVuZGVmaW5lZCIsInJlZmVycmVyIiwiZG9jdW1lbnQiLCJwdXNoIiwicGVyc2lzdENsaWNrRXZlbnRzIiwiYW5hbHl0aWNzIiwidHJhY2siLCJhZmZpbGlhdGVfcHJvZHVjdF9pZCIsInByb2R1Y3RJZCIsImFmZmlsaWF0ZV9hc2luIiwiYXNpbiIsImFmZmlsaWF0ZV9jYXRlZ29yeSIsImFmZmlsaWF0ZV9wcmljZSIsInByaWNlIiwiYWZmaWxpYXRlX2N1cnJlbmN5IiwiY3VycmVuY3kiLCJhZmZpbGlhdGVfc291cmNlIiwiYWZmaWxpYXRlX3VybCIsImFmZmlsaWF0ZVVybCIsIm9yaWdpbmFsX3VybCIsIm9yaWdpbmFsVXJsIiwidXNlcl9pZCIsInVzZXJJZCIsInNlc3Npb25faWQiLCJzZXNzaW9uSWQiLCJjb25maWciLCJmZWF0dXJlcyIsImFmZmlsaWF0ZVRyYWNraW5nIiwiZmV0Y2giLCJhcGlVcmwiLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsInN0cmluZ2lmeSIsImNvbnZlcnNpb25FdmVudCIsImNvbnZlcnNpb25UaW1lc3RhbXAiLCJwZXJzaXN0Q29udmVyc2lvbkV2ZW50cyIsImFmZmlsaWF0ZV9vcmRlcl9pZCIsIm9yZGVySWQiLCJhZmZpbGlhdGVfcmV2ZW51ZSIsInJldmVudWUiLCJhZmZpbGlhdGVfY29tbWlzc2lvbiIsImNvbW1pc3Npb24iLCJhZmZpbGlhdGVfcXVhbnRpdHkiLCJxdWFudGl0eSIsImNvbnZlcnNpb25fdGltZV9taW51dGVzIiwiY2xpY2tUaW1lc3RhbXAiLCJnZXRBbmFseXRpY3MiLCJ0aW1lZnJhbWUiLCJ0aW1lZnJhbU1zIiwiZGF5Iiwid2VlayIsIm1vbnRoIiwieWVhciIsImFsbCIsIkluZmluaXR5IiwiY3V0b2ZmIiwicmVsZXZhbnRDbGlja3MiLCJmaWx0ZXIiLCJyZWxldmFudENvbnZlcnNpb25zIiwidG90YWxDbGlja3MiLCJsZW5ndGgiLCJ0b3RhbENvbnZlcnNpb25zIiwidG90YWxSZXZlbnVlIiwicmVkdWNlIiwic3VtIiwidG90YWxDb21taXNzaW9uIiwiY29udmVyc2lvblJhdGUiLCJhdmVyYWdlT3JkZXJWYWx1ZSIsImNsaWNrc0J5Q2F0ZWdvcnkiLCJyZXZlbnVlQnlDYXRlZ29yeSIsInBlcmZvcm1hbmNlQnlTb3VyY2UiLCJjbGlja3NCeVNvdXJjZSIsImNvbnZlcnNpb25zQnlTb3VyY2UiLCJyZXZlbnVlQnlTb3VyY2UiLCJmaW5kIiwiY2xpY2siLCJrZXlzIiwiY2xpY2tzIiwiY29udmVyc2lvbnMiLCJ0b3BQZXJmb3JtaW5nUHJvZHVjdHMiLCJhc2luUGF0dGVybnMiLCJwYXR0ZXJuIiwibWF0Y2giLCJ1cmxPYmoiLCJ2YWxpZERvbWFpbnMiLCJzb21lIiwiZG9tYWluIiwibm9ybWFsaXplZENhdGVnb3J5IiwidG9Mb3dlckNhc2UiLCJyZXBsYWNlIiwiY2F0ZWdvcnlNYXBwaW5ncyIsIm1hcHBlZENhdGVnb3J5IiwiY29tbWlzc2lvblJhdGVzIiwiZGVmYXVsdCIsInJhbmRvbSIsIk1hdGgiLCJzdWJzdHIiLCJzZXRJdGVtIiwidGhpcnR5RGF5c0FnbyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztDQU1DOzs7Ozs7Ozs7OztJQTJGWUEsc0JBQXNCO2VBQXRCQTs7SUF5ZkFDLGdCQUFnQjtlQUFoQkE7O0lBZUFDLFdBQVc7ZUFBWEE7O0lBWkFDLHFCQUFxQjtlQUFyQkE7O0lBR0FDLGtCQUFrQjtlQUFsQkE7O0lBZUFDLHFCQUFxQjtlQUFyQkE7O0lBRkFDLGlCQUFpQjtlQUFqQkE7O0lBRkFDLGdCQUFnQjtlQUFoQkE7O0lBUkFDLG1CQUFtQjtlQUFuQkE7O0lBR0FDLHdCQUF3QjtlQUF4QkE7Ozt3QkE5bEJ3QjsyQkFDWDtBQXdGbkIsTUFBTVQ7SUFLWCxhQUFzQjthQUhkVSxjQUFxQyxFQUFFO2FBQ3ZDQyxtQkFBK0MsRUFBRTtRQUd2RCxJQUFJLENBQUNDLGtCQUFrQjtJQUN6QjtJQUVBLE9BQU9DLGNBQXNDO1FBQzNDLElBQUksQ0FBQ2IsdUJBQXVCYyxRQUFRLEVBQUU7WUFDcENkLHVCQUF1QmMsUUFBUSxHQUFHLElBQUlkO1FB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